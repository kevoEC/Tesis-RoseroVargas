# FrontEnd
trigger:
  branches:
    include:
      - master

pr:
  branches:
    include:
      - master

pool:
  vmImage: 'ubuntu-latest'

variables:
  - group: azure-static-web-apps-black-grass-04c403c0f-variable-group

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '22.16.0'
    displayName: 'Instalar Node.js'

  - checkout: self
    submodules: true

  - script: |
      cd Tesis-SG-Front
      npm install
      # Asegúrate de que vite tenga permisos de ejecución
      chmod +x ./node_modules/.bin/vite
      # Agrega el directorio de binarios de node_modules al PATH, por si acaso
      export PATH=$PATH:./node_modules/.bin
      # Ejecuta el comando de construcción usando npm run build
      npm run build
    displayName: 'Instalar dependencias y compilar el proyecto con Vite'

  - task: AzureStaticWebApp@0
    displayName: 'Desplegar en Azure Static Web App'
    inputs:
      azure_static_web_apps_api_token: $(AZURE_STATIC_WEB_APPS_API_TOKEN_BLACK_GRASS_04C403C0F)
      app_location: "client"
      output_location: "dist"
