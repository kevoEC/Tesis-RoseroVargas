import{c as C,r as o,j as a,G as j,B as b,t as c,L as w,u as P,C as N,d as v,e as D,a as E}from"./index-ABbIRX4x.js";import{T as k}from"./TablaCustom2-DS7_i3Ng.js";import{D as A,a as S,b as L,c as M,d as O}from"./jspdf.plugin.autotable-CZR7NrjE.js";import{c as T,d as F,e as G}from"./PagosService-zqIVeg-f.js";import{a as $}from"./CalendarioOperacionesService-Pd8v99_L.js";function z({onClose:s,onSaved:l,initialData:m}){const{user:t}=C(),[x,u]=o.useState(!1),[i,g]=o.useState([]),[n,h]=o.useState({idCalendario:"",detalle:"",...m});o.useEffect(()=>{(async()=>{try{const e=await $();g(Array.isArray(e)?e:[])}catch{c.error("Error al cargar calendarios")}})()},[]);const p=(r,e)=>h(d=>({...d,[r]:e})),f=async r=>{r.preventDefault(),u(!0);try{const e={idCalendario:Number(n.idCalendario),cantidadPagos:0,descartarPagos:!1,generarPagos:!1,detalle:n.detalle,confirmarRegistrosPagos:!1,idUsuarioCreacion:t==null?void 0:t.id,idUsuarioPropietario:t==null?void 0:t.id};await T(e),c.success("Pago creado correctamente"),l==null||l(),s==null||s()}catch(e){c.error(`Error al crear pago: ${e.message??e}`)}finally{u(!1)}};return a.jsxs("div",{className:"relative px-2 py-3 md:px-7 md:py-7",children:[a.jsx(j,{visible:x,message:"Guardando pago..."}),a.jsxs("form",{onSubmit:f,className:"space-y-8 max-w-xl mx-auto",autoComplete:"off",children:[a.jsxs("section",{className:"bg-white rounded-2xl border border-gray-300 px-7 py-5 flex flex-col gap-4 shadow-lg transition-colors",children:[a.jsx("h3",{className:"font-semibold text-lg text-blue-900 mb-3 border-b pb-2",children:"Datos del Pago"}),a.jsx(y,{label:"Calendario",children:a.jsxs("select",{className:"w-full border rounded-md p-2 bg-white text-sm",value:n.idCalendario,onChange:r=>p("idCalendario",r.target.value),required:!0,children:[a.jsx("option",{value:"",children:"Seleccionar calendario..."}),i.length===0&&a.jsx("option",{disabled:!0,value:"",children:"No hay calendarios disponibles"}),i.map(r=>a.jsx("option",{value:r.idCalendario,children:r.nombre},r.idCalendario))]})}),a.jsx(y,{label:"Detalle",children:a.jsx("textarea",{className:"w-full border rounded-md p-2 bg-white text-sm",placeholder:"Detalle del pago...",value:n.detalle,rows:3,onChange:r=>p("detalle",r.target.value),required:!0})})]}),a.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[a.jsx(b,{type:"button",variant:"outline",onClick:s,className:"px-6 py-2",children:"Cancelar"}),a.jsx(b,{type:"submit",className:"bg-violet-600 hover:bg-violet-700 text-white px-6 py-2",children:m?"Actualizar Pago":"Crear Pago"})]})]})]})}function y({label:s,children:l}){return a.jsxs("div",{className:"space-y-1.5",children:[a.jsx(w,{className:"font-medium text-gray-700 text-sm",children:s}),l]})}function q(){const s=P(),[l,m]=o.useState([]),[t,x]=o.useState(!0),[u,i]=o.useState(!1),g=async()=>{x(!0);try{const e=await F();m(Array.isArray(e)?e:[])}catch(e){c.error("Error al cargar pagos: "+(e.message??e))}finally{x(!1)}};o.useEffect(()=>{g()},[]);const n=e=>{s(`/pagos/editar/${e.idPago}`)},h=async e=>{if(window.confirm("¿Eliminar este pago?"))try{await G(e.idPago),c.success("Pago eliminado."),g()}catch(d){c.error("Error al eliminar pago: "+(d.message??d))}},p=()=>i(!0),f=[{key:"idPago",label:"ID",render:e=>a.jsxs("div",{className:"flex items-center justify-center group relative text-violet-500",children:[a.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",strokeWidth:"1.8",viewBox:"0 0 24 24",children:[a.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",stroke:"currentColor",strokeWidth:"1.8"}),a.jsx("path",{d:"M8 8h8M8 12h8M8 16h4",stroke:"currentColor",strokeWidth:"1.5"})]}),a.jsxs("span",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-1 text-xs text-white bg-zinc-800 px-2 py-0.5 rounded shadow opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-50 whitespace-nowrap",children:["ID: ",e]})]})},{key:"detalle",label:"Detalle"},{key:"cantidadPagos",label:"Cantidad de Pagos",render:e=>a.jsx("span",{children:e??0})},{key:"generarPagos",label:"Pagos generados",render:e=>a.jsx("span",{className:`px-2 py-1 text-xs rounded-full font-semibold ${e?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:e?"Sí":"No"})},{key:"confirmarRegistrosPagos",label:"Estado",render:e=>a.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${e?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-800"}`,children:e?"Completado":"Pendiente"})},{key:"fechaCreacion",label:"Creación",render:e=>e?new Date(e).toLocaleString("es-EC"):""},{key:"fechaModificacion",label:"Modificación",render:e=>e?new Date(e).toLocaleString("es-EC"):"-"}],r=[...l].sort((e,d)=>new Date(d.fechaCreacion)-new Date(e.fechaCreacion));return a.jsxs("div",{className:"p-4 sm:p-6 md:p-8 max-w-full relative",children:[a.jsx(j,{visible:t,message:"Cargando pagos..."}),a.jsxs(N,{className:"w-full border border-muted rounded-xl shadow-[0_4px_10px_rgba(0,0,0,0.12)]",children:[a.jsx(v,{children:a.jsx(D,{className:"text-3xl flex items-center",children:"Lista de Pagos"})}),a.jsx(E,{className:"p-6 overflow-x-auto",children:a.jsx(k,{columns:f,data:r,mostrarEditar:!0,mostrarAgregarNuevo:!0,mostrarEliminar:!0,onAgregarNuevoClick:p,onEditarClick:n,onEliminarClick:h})})]}),a.jsx(A,{open:u,onOpenChange:i,children:a.jsxs(S,{className:"min-w-[420px] max-w-xl",children:[a.jsxs(L,{children:[a.jsx(M,{children:"Agregar Pago"}),a.jsx(O,{children:"Completa la información del nuevo pago"})]}),a.jsx(z,{onClose:()=>i(!1),onSaved:g})]})})]})}export{q as default};
