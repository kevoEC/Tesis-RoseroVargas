import{A as d,r as i,j as a,B as E,a0 as T,L as $,I as k,a1 as C,t as x}from"./index-CG6H-kfp.js";const m=async e=>{if(!e.ok){const t=await e.text();throw new Error(t||"Error en la solicitud")}return await e.json()},f=()=>{var t;return{"Content-Type":"application/json",Authorization:`Bearer ${(t=JSON.parse(localStorage.getItem("user")))==null?void 0:t.token}`}},F=async e=>{const t=await fetch(`${d}/vista/documento/filtrar?por=IdDocumento&id=${e}`,{headers:f()});return m(t)},U=async(e,t)=>{const n=await fetch(`${d}/Documento/${e}/archivo`,{method:"PUT",headers:f(),body:JSON.stringify(t)});return m(n)},P=async e=>{const t=await fetch(`${d}/Documento/motivo`,{method:"POST",headers:f(),body:JSON.stringify(e)});return m(t)},z=async(e,t)=>{const n=await fetch(`${d}/Documento/motivo/32?idSolicitudInversion=${e}`,{method:"DELETE",headers:f()});return m(n)},_=async(e,t=32)=>{const n=await fetch(`${d}/documento/por-solicitud-y-motivo?idSolicitudInversion=${e}&idMotivo=${t}`,{headers:f()});return m(n)},I=async e=>{var l;const t=(l=JSON.parse(localStorage.getItem("user")))==null?void 0:l.token,n=await fetch(`${d}/documento/descargar/${e}`,{headers:{Authorization:`Bearer ${t}`}});if(!n.ok)throw new Error("No se pudo descargar el archivo");return await n.blob()};function G({documentoId:e,onClose:t}){const[n,l]=i.useState(""),[v,w]=i.useState(""),[u,b]=i.useState(null),[A,D]=i.useState("Subido por el cliente"),[g,p]=i.useState(!1),[N,y]=i.useState("");i.useEffect(()=>{(async()=>{var r,s;p(!0);try{const o=await F(e),c=((r=o[0])==null?void 0:r.base64Contenido)||((s=o[0])==null?void 0:s.archivo)||"";c&&(l(c),w(S(c)))}catch{y("Error al cargar el archivo.")}finally{p(!1)}})()},[e]);const S=r=>{const s=r.slice(0,10);return s.startsWith("JVBERi0")?"pdf":s.startsWith("UEsD")?"docx":""},B=r=>{const s=r.target.files[0];if(!s)return;const o=new FileReader;o.onload=()=>{const c=o.result.split(",")[1];b(c)},o.readAsDataURL(s)},O=async()=>{if(!u){y("Selecciona un archivo para continuar");return}p(!0),y("");try{(await U(e,{base64Contenido:u,observaciones:A})).success?(x.success("Archivo guardado correctamente"),l(u),w(S(u)),b(null),t==null||t()):x.error("Error al guardar el archivo")}catch{x.error("OcurriÃ³ un error al guardar")}finally{p(!1)}},L=async()=>{var r,s;try{const o=await I(e),c=window.URL.createObjectURL(o),h=document.createElement("a");h.href=c;const j=(r=o==null?void 0:o.headers)==null?void 0:r.get("Content-Disposition"),R=((s=j==null?void 0:j.match(/filename="?(.+)"?/))==null?void 0:s[1])||`documento_${e}.docx`;h.download=R,document.body.appendChild(h),h.click(),h.remove()}catch{x.error("No se pudo descargar el archivo")}};return a.jsxs("div",{className:"space-y-6",children:[a.jsx("h2",{className:"text-2xl font-semibold",children:"Adjunto"}),N&&a.jsx("p",{className:"text-red-500 text-sm",children:N}),v==="pdf"&&a.jsx("iframe",{src:`data:application/pdf;base64,${n}`,title:"Vista previa del documento",className:"w-full h-[500px] border border-gray-300 rounded-md"}),v==="docx"&&a.jsx("div",{className:"text-right",children:a.jsxs(E,{variant:"outline",className:"flex items-center gap-2",onClick:L,children:[a.jsx(T,{className:"w-4 h-4"}),"Descargar archivo"]})}),!v&&!g&&a.jsx("p",{className:"text-gray-500",children:"No hay archivo cargado."}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx($,{className:"text-sm font-medium text-gray-700",children:"Seleccionar archivo"}),a.jsx(k,{type:"file",accept:"application/pdf",onChange:B,className:"cursor-pointer file:text-sm file:font-medium file:bg-primary file:text-white file:border-0 file:px-4 file:py-2 file:rounded-md"})]}),a.jsxs("div",{children:[a.jsx($,{className:"text-sm font-medium text-gray-700",children:"Observaciones"}),a.jsx(k,{value:A,onChange:r=>D(r.target.value),placeholder:"Subido por el cliente"})]}),a.jsx("div",{className:"flex justify-end",children:a.jsxs(E,{onClick:O,disabled:g||!u,className:"bg-primary text-white hover:bg-primary/80 flex items-center gap-2",children:[a.jsx(C,{className:"w-4 h-4"}),g?"Guardando...":"Guardar Adjunto"]})})]})]})}export{G as A,P as a,z as d,_ as g};
