import{A as S,e as U,a2 as H,u as J,r as c,j as e,C as R,a as A,B as C,L as z,I as K}from"./index-CG6H-kfp.js";import{D as Q,a as W,b as X,c as Y,e as Z}from"./dialog-2_FlWSQy.js";import{S as ee,a as ae,b as te,c as re,d as oe}from"./select-B3dX9JJ0.js";import{T as ie}from"./TablaCustom2-CwS24NS9.js";const P=()=>{var r;return{"Content-Type":"application/json",Authorization:`Bearer ${(r=JSON.parse(localStorage.getItem("user")))==null?void 0:r.token}`}},I=async o=>{if(!o.ok){const r=await o.text();throw new Error(r||"Error en la solicitud")}return await o.json()},pe=async o=>{const r=await fetch(`${S}/Proyeccion/solicitud/${o}`,{headers:P()});return I(r)},se=async o=>{const r=await fetch(`${S}/Proyeccion`,{method:"POST",headers:P(),body:JSON.stringify(o)});return I(r)},le=async o=>{const r=await fetch(`${S}/Producto/${o}/configuraciones`,{headers:P()});return I(r)};function n(o){return`$${Number(o).toLocaleString("es-EC",{minimumFractionDigits:2})}`}function E(o){return o?new Date(o).toLocaleDateString("es-EC",{day:"2-digit",month:"2-digit",year:"numeric"}):""}function ne(){const{id:o}=U(),{notify:r,user:d}=H();J();const[t,p]=c.useState({tipoSolicitud:"1",idProducto:"2",capital:0,plazo:"",fechaInicial:"",aporteAdicional:null,idOrigenCapital:"1",idOrigenIncremento:null,idSolicitudInversion:parseInt(o),costeOperativo:0,costeNotarizacion:null}),[b,g]=c.useState([]),[i,D]=c.useState(null),[s,L]=c.useState(!1),[$,j]=c.useState(!1),[O,B]=c.useState(null),[w,f]=c.useState(null),[k,y]=c.useState(!1),l=(a,u)=>{p(v=>({...v,[a]:u}))},M=async()=>{try{const a={...t,idProducto:parseInt(t.idProducto),idOrigenCapital:parseInt(t.idOrigenCapital),plazo:parseInt(t.plazo),capital:parseFloat(t.capital)},v=(await le(a.idProducto)).filter(x=>x.idOrigen===a.idOrigenCapital&&x.plazo===a.plazo);if(v.length===0){r.error("No hay configuraciones con ese origen y plazo."),y(!1),f(null);return}const F=v.find(x=>a.capital>=x.montoMinimo&&a.capital<=x.montoMaximo);if(!F){r.error("El capital ingresado no está en un rango válido para ese origen y plazo."),y(!1),f(null);return}r.success("Tasa encontrada correctamente."),f(F.taza),y(!0)}catch(a){console.error("Error al consultar tasa:",a),r.error("Error al consultar la tasa."),y(!1),f(null)}},V=async()=>{if(!k){r.error("Debes consultar y validar la tasa antes de generar.");return}try{const a={...t,idProducto:parseInt(t.idProducto),idUsuario:(d==null?void 0:d.idUsuario)??0,idOrigenCapital:parseInt(t.idOrigenCapital),idOrigenIncremento:t.idOrigenIncremento?parseInt(t.idOrigenIncremento):null,tipoSolicitud:parseInt(t.tipoSolicitud)},u=await se(a);u.success?(D(u.proyeccion),g(u.cronograma),r.success("Cronograma generado correctamente."),L(!0)):r.error("No se pudo generar la proyección.")}catch(a){r.error("Error al generar proyección."),console.error("Error al generar proyección:",a)}},_=()=>{if(!t.capital||!t.plazo||!t.fechaInicial){r.error("Todos los campos obligatorios deben estar completos.");return}B(()=>V),j(!0)},q=t.tipoSolicitud==="2"||t.tipoSolicitud==="3",G=t.tipoSolicitud==="3",T=t.idOrigenCapital==="2"?["6","12","24","36"]:["7","13","25","37"];return t.idProducto,e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:"Nueva Proyección"})}),e.jsx(R,{className:"border border-gray-700 shadow-sm bg-white rounded-2xl",children:e.jsxs(A,{className:"p-6 space-y-8",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"Datos para la proyección"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(h,{label:"Tipo de solicitud",value:t.tipoSolicitud,onChange:a=>l("tipoSolicitud",a),options:["1"],labels:["Nueva"],disabled:s}),e.jsx(h,{label:"Producto",value:t.idProducto,onChange:a=>l("idProducto",a),options:["1","2","3","4","5"],labels:["Renta Fija","Renta Periódica Mensual","Renta Periódica Bimensual","Renta Periódica Trimestral","Renta Periódica Semestral"],disabled:s}),e.jsx(N,{label:"Capital",value:t.capital,onChange:a=>l("capital",parseFloat(a.target.value)),disabled:s}),e.jsx(h,{label:"Plazo",value:t.plazo,onChange:a=>l("plazo",a),options:T,labels:T.map(a=>`${a} meses`),disabled:s}),e.jsx(N,{label:"Fecha inicial",type:"date",value:t.fechaInicial,onChange:a=>l("fechaInicial",a.target.value),disabled:s}),q&&e.jsx(N,{label:"Aporte adicional",value:t.aporteAdicional??"",onChange:a=>l("aporteAdicional",parseFloat(a.target.value)),disabled:s}),e.jsx(h,{label:"Origen del capital",value:t.idOrigenCapital,onChange:a=>l("idOrigenCapital",a),options:["1","2"],labels:["Local","Extranjero"],disabled:s}),G&&e.jsx(h,{label:"Origen del incremento",value:t.idOrigenIncremento,onChange:a=>l("idOrigenIncremento",a),options:["1","2"],labels:["Local","Extranjero"],disabled:s}),e.jsx(N,{label:"Coste operativo",value:t.costeOperativo,onChange:a=>l("costeOperativo",parseFloat(a.target.value)),disabled:s})]}),w!==null&&e.jsx("div",{className:"bg-blue-100 border border-blue-300 rounded-xl p-4 flex justify-center items-center",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Tasa asignada"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-800",children:[w.toFixed(2),"%"]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-4 pt-4",children:[e.jsx(C,{onClick:M,disabled:s,className:"bg-blue-600 hover:bg-blue-800 text-white shadow",children:"Consultar tasa"}),e.jsx(C,{onClick:_,disabled:s||!k,className:"bg-green-600 hover:bg-green-800 text-white shadow",children:"Generar cronograma"})]})]})}),b.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(R,{children:e.jsx(A,{children:e.jsx(ie,{data:b,columns:[{key:"periodo",label:"Período",render:a=>e.jsx("div",{className:"text-center",children:a})},{key:"fechaInicial",label:"F. Inicial",render:a=>e.jsx("div",{className:"text-center",children:E(a)})},{key:"fechaVencimiento",label:"F. Vencimiento",render:a=>e.jsx("div",{className:"text-center",children:E(a)})},{key:"tasa",label:"Tasa",render:a=>e.jsxs("div",{className:"text-center",children:[a.toFixed(2),"%"]})},{key:"aporteAdicional",label:"Aporte Adic.",render:a=>e.jsx("div",{className:"text-right",children:n(a)})},{key:"capitalOperacion",label:"Capital",render:a=>e.jsx("div",{className:"text-right",children:n(a)})},{key:"rentabilidad",label:"Rentabilidad",render:a=>e.jsx("div",{className:"text-right",children:n(a)})},{key:"capitalRenta",label:"Capital Renta",render:a=>e.jsx("div",{className:"text-right",children:n(a)})},{key:"costoOperativo",label:"Coste Op.",render:a=>e.jsx("div",{className:"text-right",children:n(a)})},{key:"rentaAcumulada",label:"Renta Acum.",render:a=>e.jsx("div",{className:"text-right",children:n(a)})},{key:"capitalFinal",label:"Capital Final",render:a=>e.jsx("div",{className:"text-right",children:n(a)})},{key:"montoPagar",label:"Monto a Pagar",render:a=>e.jsx("div",{className:"text-right",children:n(a)})}],mostrarAgregarNuevo:!1,mostrarEditar:!1,mostrarEliminar:!1})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mt-6",children:[e.jsx(m,{label:"Rentabilidad Total",value:i==null?void 0:i.totalRentabilidad}),e.jsx(m,{label:"Coste Operativo Total",value:i==null?void 0:i.totalCosteOperativo}),e.jsx(m,{label:"Valor a Liquidar",value:i==null?void 0:i.valorProyectadoLiquidar}),e.jsx(m,{label:"Renta Total",value:i==null?void 0:i.totalRentaPeriodo}),e.jsx(m,{label:"Capital + Rendimiento",value:i==null?void 0:i.rendimientosMasCapital}),t.tipoSolicitud==="3"&&(i==null?void 0:i.fechaIncremento)&&e.jsx(m,{label:"Fecha Incremento",value:new Date(i.fechaIncremento).toLocaleDateString()})]})]}),e.jsx(Q,{open:$,onOpenChange:j,children:e.jsxs(W,{className:"backdrop-blur-md max-w-md",children:[e.jsx(X,{children:e.jsx(Y,{children:"¿Generar cronograma?"})}),e.jsx("p",{className:"text-sm text-gray-500",children:"¿Estás seguro de que deseas generar el cronograma?"}),e.jsxs(Z,{className:"pt-4",children:[e.jsx(C,{variant:"outline",onClick:()=>j(!1),children:"Cancelar"}),e.jsx(C,{className:"bg-primary text-white hover:bg-primary/70",onClick:()=>{j(!1),O&&O()},children:"Confirmar"})]})]})})]})}function N({label:o,value:r,onChange:d,type:t="number",disabled:p}){return e.jsxs("div",{className:"space-y-1",children:[e.jsx(z,{className:"text-sm text-gray-700 font-medium",children:o}),e.jsx(K,{type:t,value:r,onChange:d,disabled:p,className:"text-sm border-gray-700 bg-white",placeholder:o})]})}function h({label:o,value:r,onChange:d,options:t,labels:p=[],disabled:b}){return e.jsxs("div",{className:"space-y-1",children:[e.jsx(z,{className:"text-sm text-gray-700 font-medium",children:o}),e.jsxs(ee,{value:r,onValueChange:d,disabled:b,children:[e.jsx(ae,{className:"text-sm border-gray-700 bg-white",children:e.jsx(te,{placeholder:o})}),e.jsx(re,{className:"bg-white",children:t.map((g,i)=>e.jsx(oe,{value:g,children:p[i]??g},g))})]})]})}function m({label:o,value:r}){return e.jsxs("div",{className:"bg-gray-100 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-xs text-gray-500",children:o}),e.jsx("div",{className:"text-lg font-semibold text-gray-800",children:typeof r=="number"?n(r):r})]})}const ge=Object.freeze(Object.defineProperty({__proto__:null,default:ne},Symbol.toStringTag,{value:"Module"}));export{ne as P,ge as a,pe as g};
