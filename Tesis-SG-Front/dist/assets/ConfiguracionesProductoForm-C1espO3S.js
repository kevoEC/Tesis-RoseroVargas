import{A as m,c as C,r as x,j as e,G as E,I as l,B as y,t as f,L as N}from"./index-ABbIRX4x.js";const p=()=>{var o;return{"Content-Type":"application/json",Authorization:`Bearer ${(o=JSON.parse(localStorage.getItem("user")))==null?void 0:o.token}`}},g=async r=>{if(!r.ok){const o=await r.text();throw new Error(o||"Error en la solicitud")}return r.json()},M=async r=>{const o=await fetch(`${m}/ConfiguracionProducto/vista/por-producto/${r}`,{headers:p()});return g(o)},O=async r=>{const o=await fetch(`${m}/ConfiguracionProducto`,{method:"POST",headers:p(),body:JSON.stringify(r)});return g(o)},P=async(r,o)=>{const c=await fetch(`${m}/ConfiguracionProducto/${r}`,{method:"PUT",headers:p(),body:JSON.stringify(o)});return g(c)},A=async r=>{const o=await fetch(`${m}/ConfiguracionProducto/${r}`,{method:"DELETE",headers:p()});return g(o)},w=[{idOrigen:1,origenNombre:"Local"},{idOrigen:2,origenNombre:"Extranjero"}],U=[{idTipoTasa:1,tipoTasaNombre:"Por plazo"},{idTipoTasa:2,tipoTasaNombre:"Fija"},{idTipoTasa:3,tipoTasaNombre:"Variable"}];function S({idProducto:r,initialData:o,onClose:c,onSaved:h}){const{user:d}=C(),[T,b]=x.useState(!1),[t,j]=x.useState({montoMinimo:"",montoMaximo:"",plazo:"",taza:"",costeOperativoEEUU:"",idOrigen:"",idTipoTasa:"",...o});x.useEffect(()=>{o&&j({...o})},[o]);const i=(a,n)=>j(u=>({...u,[a]:n})),v=async a=>{a.preventDefault(),b(!0);try{const n={montoMinimo:Number(t.montoMinimo),montoMaximo:Number(t.montoMaximo),plazo:Number(t.plazo),taza:Number(t.taza),costeOperativoEEUU:Number(t.costeOperativoEEUU),idOrigen:Number(t.idOrigen),idTipoTasa:Number(t.idTipoTasa),idProducto:Number(r)};if(o&&o.idConfiguraciones){const u={idConfiguraciones:o.idConfiguraciones,...n,idUsuarioCreacion:o.idUsuarioCreacion,fechaCreacion:o.fechaCreacion,idUsuarioModificacion:d==null?void 0:d.id,fechaModificacion:new Date().toISOString()};console.log("Payload UPDATE",u),await P(o.idConfiguraciones,u),f.success("Configuración actualizada correctamente")}else await O({...n,idUsuarioCreacion:d==null?void 0:d.id,fechaCreacion:new Date().toISOString()}),f.success("Configuración creada correctamente");h==null||h(),c==null||c()}catch(n){f.error(`Error al guardar configuración: ${n.message??n}`)}finally{b(!1)}};return e.jsxs("div",{className:"relative px-2 py-3 md:px-5 md:py-5",children:[e.jsx(E,{visible:T,message:"Guardando configuración..."}),e.jsxs("form",{onSubmit:v,className:"space-y-7 max-w-xl mx-auto",autoComplete:"off",children:[e.jsxs("section",{className:"bg-white rounded-2xl border border-gray-300 px-7 py-5 flex flex-col gap-4 shadow-lg transition-colors",children:[e.jsx("h3",{className:"font-semibold text-lg text-violet-700 mb-3 border-b pb-2",children:"Configuración del Producto"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(s,{label:"Monto mínimo",children:e.jsx(l,{type:"number",min:0,step:.01,value:t.montoMinimo,onChange:a=>i("montoMinimo",a.target.value),required:!0,placeholder:"Ej: 1000.00"})}),e.jsx(s,{label:"Monto máximo",children:e.jsx(l,{type:"number",min:0,step:.01,value:t.montoMaximo,onChange:a=>i("montoMaximo",a.target.value),required:!0,placeholder:"Ej: 5000.00"})}),e.jsx(s,{label:"Plazo (meses)",children:e.jsx(l,{type:"number",min:1,step:1,value:t.plazo,onChange:a=>i("plazo",a.target.value),required:!0,placeholder:"Ej: 6"})}),e.jsx(s,{label:"Tasa (%)",children:e.jsx(l,{type:"number",min:0,step:.01,value:t.taza,onChange:a=>i("taza",a.target.value),required:!0,placeholder:"Ej: 1.45"})}),e.jsx(s,{label:"Costo Operativo EEUU",children:e.jsx(l,{type:"number",min:0,step:.01,value:t.costeOperativoEEUU,onChange:a=>i("costeOperativoEEUU",a.target.value),required:!0,placeholder:"Ej: 70.00"})}),e.jsx(s,{label:"Origen de fondos",children:e.jsxs("select",{className:"w-full border rounded-md p-2 bg-white text-sm",value:t.idOrigen,onChange:a=>i("idOrigen",a.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar..."}),w.map(a=>e.jsx("option",{value:a.idOrigen,children:a.origenNombre},a.idOrigen))]})}),e.jsx(s,{label:"Tipo de tasa",children:e.jsxs("select",{className:"w-full border rounded-md p-2 bg-white text-sm",value:t.idTipoTasa,onChange:a=>i("idTipoTasa",a.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar..."}),U.map(a=>e.jsx("option",{value:a.idTipoTasa,children:a.tipoTasaNombre},a.idTipoTasa))]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[e.jsx(y,{type:"button",variant:"outline",onClick:c,className:"px-6 py-2",children:"Cancelar"}),e.jsx(y,{type:"submit",className:"bg-violet-600 hover:bg-violet-700 text-white px-6 py-2",children:o?"Actualizar":"Crear"})]})]})]})}function s({label:r,children:o}){return e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(N,{className:"font-medium text-gray-700 text-sm",children:r}),o]})}const $=Object.freeze(Object.defineProperty({__proto__:null,default:S},Symbol.toStringTag,{value:"Module"}));export{S as C,$ as a,A as d,M as g};
