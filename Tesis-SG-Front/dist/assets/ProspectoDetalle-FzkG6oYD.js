import{j as e,X as q,A as B,r as d,G as K,L as z,B as I,I as Q,e as Y,u as Z,t as ee,C as P,a as E}from"./index-CG6H-kfp.js";import{D as V,a as H,b as _,c as G,d as R}from"./dialog-2_FlWSQy.js";import{T as $}from"./TablaCustom2-CwS24NS9.js";import{S as ae,a as te,b as ie,c as oe,d as re}from"./select-B3dX9JJ0.js";import se from"./SolicitudInversionForm-CN5YfxLU.js";import{a as ne}from"./ProspectoService-CHx1iZIb.js";import{f as de}from"./SolicitudService-CKfwnCvg.js";import{g as le}from"./PrioridadService-DZxlRSQj.js";import{g as ce}from"./TipoActividadService-CRHLtdms.js";import"./index-DMmKv1VD.js";import"./switch-f3LOaz4k.js";import"./TipoIdentificacionService-DqUkVc03.js";function ue({className:t,...i}){return e.jsx("textarea",{"data-slot":"textarea",className:q("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...i})}const J=async t=>{if(!t.ok){const i=await t.text();throw new Error(i||"Error en la solicitud")}return await t.json()},W=()=>{var i;return{"Content-Type":"application/json",Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("user")))==null?void 0:i.token}`}},F=async t=>{const i=await fetch(`${B}/vista/actividad/filtrar?por=IdProspecto&id=${t}`,{headers:W()});return J(i)},me=async t=>{const i=await fetch(`${B}/Actividad`,{method:"POST",headers:W(),body:JSON.stringify(t)});return J(i)};function L({open:t,onClose:i,onActividadCreada:r,modo:m,actividadEditar:p=null,tiposActividad:y=[],prioridades:C=[],idProspecto:w}){const[N,b]=d.useState(!1),[s,h]=d.useState({idTipoActividad:"",asunto:"",descripcion:"",duracion:"",vencimiento:"",idPrioridad:"",estado:"En progreso"});d.useEffect(()=>{if(m==="editar"&&p){const{idTipoActividad:a,asunto:l,descripcion:u,duracion:k,vencimiento:v,idPrioridad:j,estado:S}=p;h({idTipoActividad:(a==null?void 0:a.toString())||"",asunto:l,descripcion:u,duracion:A(k),vencimiento:v==null?void 0:v.substring(0,16),idPrioridad:(j==null?void 0:j.toString())||"",estado:S?"Finalizada":"En progreso"})}else h({idTipoActividad:"",asunto:"",descripcion:"",duracion:"",vencimiento:"",idPrioridad:"",estado:"En progreso"})},[t]);const A=a=>{const[l,u]=a.split(":").map(Number);return(l*60+u).toString()},f=a=>{const l=String(Math.floor(a/60)).padStart(2,"0"),u=String(a%60).padStart(2,"0");return`${l}:${u}:00`},x=(a,l)=>{h(u=>({...u,[a]:l}))},M=async a=>{a.preventDefault(),b(!0);const l={idTipoActividad:parseInt(s.idTipoActividad),asunto:s.asunto,descripcion:s.descripcion,duracion:f(parseInt(s.duracion)),vencimiento:s.vencimiento,idPrioridad:parseInt(s.idPrioridad),estado:s.estado==="Finalizada",idProspecto:w};try{await me(l),r&&r(),i()}catch(u){console.error("Error al crear actividad:",u),alert("Hubo un error al crear la actividad. Intenta nuevamente.")}finally{b(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(K,{message:"Guardando actividad...",visible:N}),e.jsx(V,{open:t,onOpenChange:i,children:e.jsxs(H,{className:"min-w-[900px] max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(_,{children:[e.jsx(G,{children:m==="editar"?"Editar Actividad":"Nueva Actividad"}),e.jsx(R,{children:"Completa la información de la actividad."})]}),e.jsx("div",{className:"bg-white p-6 rounded-2xl border border-gray-200 shadow-md mt-4",children:e.jsxs("form",{onSubmit:M,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(D,{label:"Tipo de Actividad",value:s.idTipoActividad,onChange:a=>x("idTipoActividad",a),options:y.map(a=>({label:a.descripcion,value:a.idTipoActividad}))}),e.jsx(D,{label:"Prioridad",value:s.idPrioridad,onChange:a=>x("idPrioridad",a),options:C.map(a=>({label:a.categoria,value:a.idPrioridad}))}),e.jsx(T,{label:"Asunto",value:s.asunto,onChange:a=>x("asunto",a.target.value)}),e.jsx(T,{label:"Duración (min)",value:s.duracion,type:"number",onChange:a=>x("duracion",a.target.value)}),e.jsx(T,{label:"Vencimiento",value:s.vencimiento,type:"datetime-local",onChange:a=>x("vencimiento",a.target.value)}),m==="editar"&&e.jsx(D,{label:"Estado",value:s.estado,onChange:a=>x("estado",a),options:[{label:"En progreso",value:"En progreso"},{label:"Finalizada",value:"Finalizada"}]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(z,{className:"text-sm text-gray-700 font-medium",children:"Descripción"}),e.jsx(ue,{rows:3,value:s.descripcion,onChange:a=>x("descripcion",a.target.value),placeholder:"Descripción",className:"text-sm border-gray-300"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(I,{type:"button",variant:"outline",onClick:i,children:"Cancelar"}),e.jsx(I,{type:"submit",children:m==="editar"?"Guardar Cambios":"Crear Actividad"})]})]})})]})})]})}function T({label:t,value:i,onChange:r,type:m="text"}){return e.jsxs("div",{className:"space-y-1",children:[e.jsx(z,{className:"text-sm text-gray-700 font-medium",children:t}),e.jsx(Q,{type:m,value:i,onChange:r,className:"text-sm border-gray-300",placeholder:t})]})}function D({label:t,value:i,onChange:r,options:m=[]}){return e.jsxs("div",{className:"space-y-1",children:[e.jsx(z,{className:"text-sm text-gray-700 font-medium",children:t}),e.jsxs(ae,{value:i,onValueChange:r,children:[e.jsx(te,{className:"text-sm border-gray-300 bg-white",children:e.jsx(ie,{placeholder:t})}),e.jsx(oe,{className:"bg-white border border-gray-200",children:m.map(p=>e.jsx(re,{value:p.value.toString(),children:p.label},p.value))})]})]})}function we(){const{id:t}=Y(),i=Z(),[r,m]=d.useState(null),[p,y]=d.useState([]),[C,w]=d.useState([]),[N,b]=d.useState(!1),[s,h]=d.useState(!1),[A,f]=d.useState(!1),[x,M]=d.useState(null),[a,l]=d.useState(null),[u,k]=d.useState([]),[v,j]=d.useState([]);d.useEffect(()=>{(async()=>{try{const[c,n]=await Promise.all([ce(),le()]);k(c),j(n)}catch(c){console.error("Error cargando catálogos:",c)}})()},[]),d.useEffect(()=>{S()},[t]);const S=async()=>{try{const o=await ne(t),c=await F(t),n=await de(t);m(o),y(c),w(n)}catch(o){ee.error("Error al cargar prospecto: "+o.message)}},O=async()=>{const o=await F(t);y(o),l(null)},U=[{key:"idActividad",label:"",render:o=>e.jsxs("div",{className:"flex items-center justify-center group relative text-gray-500",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",strokeWidth:"1.5",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 17h6m-6-4h6m2 9a2 2 0 002-2V7a2 2 0 00-2-2h-3.586a1 1 0 01-.707-.293l-1.414-1.414A1 1 0 0011.586 3H9a2 2 0 00-2 2v14a2 2 0 002 2h6z"})}),e.jsxs("span",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-1 text-xs text-white bg-zinc-800 px-2 py-0.5 rounded shadow opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-50 whitespace-nowrap",children:["ID: ",o]})]})},{key:"nombreTipoActividad",label:"Tipo"},{key:"asunto",label:"Asunto"},{key:"descripcion",label:"Descripción",render:o=>e.jsx("span",{className:"max-w-12 truncate block",children:o})},{key:"duracion",label:"Duración"},{key:"vencimiento",label:"Vencimiento"},{key:"nombrePrioridad",label:"Prioridad"},{key:"estado",label:"Estado",render:o=>e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${o?"bg-emerald-100 text-emerald-700":"bg-yellow-200 text-yellow-700"}`,children:o?"Finalizada":"En Progreso"})}],X=[{key:"idSolicitudInversion",label:"",render:o=>e.jsxs("div",{className:"flex items-center justify-center group relative text-gray-500",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",strokeWidth:"1.5",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6M5 4v16h14V4H5zm2 2h10v12H7V6z"})}),e.jsxs("span",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-1 text-xs text-white bg-zinc-800 px-2 py-0.5 rounded shadow opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-50 whitespace-nowrap",children:["ID: ",o]})]})},{key:"numeroDocumento",label:"N° Documento",render:(o,c)=>{var n;return((n=c.identificacion)==null?void 0:n.numeroDocumento)||"—"}},{key:"nombreTipoSolicitud",label:"Tipo Solicitud",render:(o,c)=>{var n;return((n=c.identificacion)==null?void 0:n.nombreTipoSolicitud)||"—"}},{key:"nombreTipoCliente",label:"Tipo Cliente",render:(o,c)=>{var n;return((n=c.identificacion)==null?void 0:n.nombreTipoCliente)||"—"}},{key:"nombreTipoDocumento",label:"Tipo Documento",render:(o,c)=>{var n;return((n=c.identificacion)==null?void 0:n.nombreTipoDocumento)||"—"}},{key:"nombreCompletoProspecto",label:"Nombre Prospecto"}];return r?e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsx("div",{children:e.jsx(I,{variant:"outline",onClick:()=>i("/prospectos/vista"),children:"Volver al Listado de Prospectos"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Detalle del Prospecto"}),e.jsx(P,{children:e.jsxs(E,{className:"p-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsx(g,{label:"Nombre completo",value:`${r.nombres} ${r.apellidoPaterno} ${r.apellidoMaterno}`}),e.jsx(g,{label:"Correo",value:r.correoElectronico}),e.jsx(g,{label:"Teléfono",value:r.telefonoCelular}),e.jsx(g,{label:"Tipo Identificación",value:r.tipoIdentificacion}),e.jsx(g,{label:"Origen del Cliente",value:r.nombreOrigen}),e.jsx(g,{label:"Producto de Interés",value:r.productoInteres}),e.jsx(g,{label:"Agencia",value:r.agencia})]})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mt-8",children:"Actividades"}),e.jsx(P,{children:e.jsx(E,{className:"p-6",children:e.jsx($,{columns:U,data:p,mostrarEditar:!0,mostrarAgregarNuevo:!0,mostrarEliminar:!0,onAgregarNuevoClick:()=>b(!0),onEditarClick:o=>{l(o),h(!0)}})})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mt-8",children:"Solicitudes de Inversión"}),e.jsx(P,{children:e.jsx(E,{className:"p-6",children:e.jsx($,{columns:X,data:C,mostrarEditar:!0,mostrarAgregarNuevo:!0,mostrarEliminar:!1,onAgregarNuevoClick:()=>f(!0),onEditarClick:o=>i(`/solicitudes/editar/${o.idSolicitudInversion}`)})})}),e.jsx(V,{open:A,onOpenChange:f,children:e.jsxs(H,{className:"min-w-[900px] max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(_,{children:[e.jsx(G,{children:"Agregar Solicitud"}),e.jsx(R,{children:"Completa la información de la solicitud."})]}),e.jsx(se,{idProspecto:t,modo:"crear",onClose:()=>{f(!1),S()}})]})}),N&&e.jsx(L,{open:N,onClose:()=>{b(!1),l(null)},idProspecto:t,modo:"crear",onActividadCreada:O,tiposActividad:u,prioridades:v}),s&&e.jsx(L,{open:s,onClose:()=>{h(!1),l(null)},idProspecto:t,modo:"editar",actividadEditar:a,onActividadCreada:O,tiposActividad:u,prioridades:v})]}):e.jsx("p",{className:"text-center text-gray-600",children:"Cargando prospecto..."})}function g({label:t,value:i}){return e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:t}),e.jsx("p",{className:"text-base font-medium text-gray-900",children:i||"-"})]})}export{we as default};
