import{A as H,r as s,j as a,G as J,B as E,S as U,C as F,d as K,e as W,a7 as X,a as Y,t as m,E as Z,z as C,L as M}from"./index-ABbIRX4x.js";import{A as Q,g as ee,d as ae,a as oe}from"./AdjuntoForm-DZV0TiXW.js";import{b as se,u as re}from"./SolicitudService-BRPNL4PC.js";import{T as te}from"./TablaCustom2-DS7_i3Ng.js";import{D as le,a as ce,b as ne,c as ie,d as me}from"./jspdf.plugin.autotable-CZR7NrjE.js";import{A as ue,a as de,b as ge,c as xe,d as he,e as fe,f as pe}from"./alert-dialog-BbB2nhGe.js";import{S as je,a as be,b as ye,c as Ce,d as De}from"./select-C75wXMdb.js";import{S as ve}from"./switch-BQg2MTGH.js";const Se=e=>({tipoSolicitud:(e==null?void 0:e.idTipoSolicitud)??(e==null?void 0:e.tipoSolicitud)??null,tipoCliente:(e==null?void 0:e.idTipoCliente)??(e==null?void 0:e.tipoCliente)??null,tipoDocumento:(e==null?void 0:e.idTipoDocumento)??(e==null?void 0:e.tipoDocumento)??null,numeroDocumento:(e==null?void 0:e.numeroDocumento)??"",nombres:(e==null?void 0:e.nombres)??"",apellidoPaterno:(e==null?void 0:e.apellidoPaterno)??"",apellidoMaterno:(e==null?void 0:e.apellidoMaterno)??"",validar:(e==null?void 0:e.validar)??!1,equifax:(e==null?void 0:e.equifax)??"",obsEquifax:(e==null?void 0:e.obsEquifax)??"",listasControl:(e==null?void 0:e.listasControl)??"",obsListasControl:(e==null?void 0:e.obsListasControl)??"",continuar:Number((e==null?void 0:e.continuar)??1)}),Ne=async e=>{if(!e.ok){const t=await e.text();throw new Error(t||"Error en la solicitud")}return await e.json()},we=()=>{var t;return{"Content-Type":"application/json",Authorization:`Bearer ${(t=JSON.parse(localStorage.getItem("user")))==null?void 0:t.token}`}},Ae=async()=>{const e=await fetch(`${H}/ModoFirma`,{headers:we()});return Ne(e)},Ee=[{nombre:"Conozca a su Cliente",url:"https://drive.google.com/file/d/1MJPmOmEEL8D_NiKFwv2xmI-f0kItRGjY/view?usp=sharing",icon:a.jsx(C,{className:"w-6 h-6 mx-auto text-primary"})},{nombre:"Tratamiento de Datos Personales",url:"https://drive.google.com/file/d/1J38gOr_pGhzNlZk7CJjBAXehhtmDGLRW/view?usp=sharing",icon:a.jsx(C,{className:"w-6 h-6 mx-auto text-sky-700"})}];function Fe({id:e}){const[t,n]=s.useState([]),[i,d]=s.useState(null),[r,u]=s.useState({idModoFirma:"1",verDocumentosRequeridos:!1,confirmaCargaDocumentosCorrectos:!1}),[T,I]=s.useState([]),[g,D]=s.useState(!1),[x,v]=s.useState(!1),[q,h]=s.useState(!1),[L,f]=s.useState(!1),[R,G]=s.useState(null),[p,S]=s.useState(!0),[l,O]=s.useState(!1),[N,z]=s.useState(!1),w=async()=>{var o,c;S(!0);try{const[j,b,$]=await Promise.all([ee(e,32),se(e),Ae()]);n(j.data||[]),d(b.data[0]);const V=((o=b.data[0])==null?void 0:o.faseProceso)!==1;O(V);const y=((c=b.data[0])==null?void 0:c.adjuntos)||{};u({idModoFirma:y.idModoFirma||"1",verDocumentosRequeridos:y.verDocumentosRequeridos||!1,confirmaCargaDocumentosCorrectos:y.confirmaCargaDocumentosCorrectos||!1}),I($||[])}catch(j){m.error("Error al cargar adjuntos: "+j.message)}finally{S(!1)}};s.useEffect(()=>{w()},[e]);const A=(o,c=!1)=>{G(o.idDocumento),z(c),f(!0)},P=async()=>{h(!1),D(!0);try{await ae(e),await oe({idMotivo:32,idSolicitudInversion:Number(e)}),u(o=>({...o,verDocumentosRequeridos:!0})),await w(),m.success("Documentos generados.")}catch(o){m.error("Error al generar documentos."+o.message)}finally{D(!1)}},_=async()=>{v(!0);try{const o={...i,identificacion:Se(i.identificacion),adjuntos:r};(await re(e,o)).success?m.success("Sección documental guardada con exito."):m.error("Error al guardar.")}catch(o){m.error("Error: "+o.message)}finally{v(!1)}},B=[{key:"idDocumento",label:"",render:(o,c)=>l?a.jsx(E,{type:"button",size:"icon",variant:"ghost",className:"text-primary hover:bg-violet-100",onClick:()=>A(c,!0),title:"Ver",children:a.jsx(Z,{size:18})}):a.jsxs("div",{className:"flex items-center justify-center group relative text-gray-500 cursor-default",title:`ID: ${o}`,children:[a.jsx(C,{className:"w-5 h-5"}),a.jsxs("span",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-1 text-xs text-white bg-zinc-800 px-2 py-0.5 rounded shadow opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap z-50",children:["ID: ",o]})]})},{key:"tipoDocumentoNombre",label:"Tipo de Documento"},{key:"motivoNombre",label:"Motivo"}];return a.jsxs("div",{className:"space-y-6 relative",children:[a.jsx(J,{visible:p||g||x,message:p?"Cargando datos...":g?"Generando documentos...":x?"Guardando...":""}),a.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Adjuntos"}),l&&a.jsx("div",{className:"w-full flex items-center px-6 py-2 mb-4 rounded-xl bg-yellow-100 border border-yellow-300 text-yellow-800 font-semibold",children:a.jsx("span",{children:"No se permite editar adjuntos en esta fase."})}),a.jsx("div",{className:"flex justify-end",children:a.jsxs(E,{onClick:_,className:"bg-primary text-white flex items-center gap-2 hover:bg-primary/80",disabled:l||x||g||p,children:[a.jsx(U,{className:"w-4 h-4"})," Guardar"]})}),a.jsx(F,{className:"p-6 border border-muted space-y-6",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[a.jsx(ke,{label:"Modo de Firma",options:T,value:r.idModoFirma,onChange:o=>u({...r,idModoFirma:o}),disabled:l||r.confirmaCargaDocumentosCorrectos}),a.jsx(k,{label:"¿Ver documentos requeridos?",checked:r.verDocumentosRequeridos,onChange:()=>!l&&h(!0),disabled:l||r.confirmaCargaDocumentosCorrectos}),a.jsx(k,{label:"¿Confirma que cargó todos los documentos?",checked:r.confirmaCargaDocumentosCorrectos,onChange:o=>!l&&u({...r,confirmaCargaDocumentosCorrectos:o}),disabled:l})]})}),a.jsxs(F,{className:"border border-muted shadow",children:[a.jsxs(K,{className:"flex flex-row items-center justify-between",children:[a.jsx(W,{children:"Lista de Adjuntos"}),a.jsx("div",{className:"flex gap-3",children:Ee.map(o=>a.jsxs("a",{href:o.url,target:"_blank",rel:"noopener noreferrer",className:"flex flex-col items-center px-3 py-2 rounded-lg border border-primary/30 hover:bg-primary/10 transition",title:`Descargar: ${o.nombre}`,children:[o.icon,a.jsx("span",{className:"text-xs font-medium text-gray-700 text-center mt-1",children:o.nombre}),a.jsxs("span",{className:"flex items-center gap-1 text-primary text-[11px] font-semibold mt-0.5",children:[a.jsx(X,{className:"w-3 h-3"}),"Descargar"]})]},o.nombre))})]}),a.jsx(Y,{className:"p-6",children:a.jsx(te,{columns:B,data:t,mostrarEditar:!l,mostrarAgregarNuevo:!1,mostrarEliminar:!1,onEditarClick:o=>A(o,!1)})})]}),a.jsx(le,{open:L,onOpenChange:f,children:a.jsxs(ce,{children:[a.jsxs(ne,{children:[a.jsx(ie,{children:"Adjunto"}),a.jsx(me,{children:N?"Visualización de archivo adjunto":"Editar archivo"})]}),a.jsx(Q,{documentoId:R,readOnly:N,onClose:()=>f(!1)})]})}),a.jsx(ue,{open:q,onOpenChange:h,children:a.jsxs(de,{className:"bg-white text-gray-900 border border-gray-300",children:[a.jsx(ge,{children:a.jsx(xe,{children:"¿Deseas generar todos los documentos requeridos?"})}),a.jsxs(he,{children:[a.jsx(fe,{children:"Cancelar"}),a.jsx(pe,{onClick:l?void 0:P,disabled:l,children:"Sí, generar"})]})]})})]})}function ke({label:e,options:t,value:n,onChange:i,disabled:d}){return a.jsxs("div",{className:"space-y-1.5",children:[a.jsx(M,{className:"text-sm font-medium text-gray-700",children:e}),a.jsxs(je,{value:n?String(n):"",onValueChange:i,disabled:d,children:[a.jsx(be,{className:"bg-white border border-gray-700",children:a.jsx(ye,{placeholder:"Seleccionar..."})}),a.jsx(Ce,{className:"bg-white",children:t.map(r=>a.jsx(De,{value:String(r.idModoFirma),children:r.nombreModoFirma},r.idModoFirma))})]})]})}function k({label:e,checked:t,onChange:n,disabled:i}){return a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(ve,{checked:t,onCheckedChange:n,disabled:i,className:`
          peer h-6 w-11 shrink-0 cursor-pointer items-center rounded-full
          border transition-colors duration-200 ease-in-out
          ${t?"bg-primary border-primary":"bg-white border-gray-400"}
        `}),a.jsx(M,{className:"text-sm text-gray-700 font-medium",children:e})]})}const ze=Object.freeze(Object.defineProperty({__proto__:null,default:Fe},Symbol.toStringTag,{value:"Module"}));export{Fe as A,ze as a,Se as m};
