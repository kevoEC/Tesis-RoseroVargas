import{a2 as Ke,r as t,t as p,j as e,i as Qe,S as De,C as V,a as L,B as J,L as P,I as z,A as T,e as he,u as ze,f as Be,aJ as We,G as Ae,a1 as Xe}from"./index-CG6H-kfp.js";import{S as X}from"./switch-f3LOaz4k.js";import{S as A,a as k,b as R,c as I,d as N}from"./select-B3dX9JJ0.js";import{e as K,v as Ze,b as ea,u as Q}from"./SolicitudService-CKfwnCvg.js";import{g as aa}from"./TipoSolicitudService-BG-MrLq3.js";import{g as ia}from"./TipoClienteService-CHYwNglY.js";import{g as Oe}from"./TipoIdentificacionService-DqUkVc03.js";import{m as Z}from"./Adjuntos-D43dGt37.js";import{P as oa,g as ra}from"./ProyeccionNueva-Dn_yQoor.js";import{T as ge}from"./TablaCustom2-CwS24NS9.js";import{D as fe,a as xe,e as pe,b as Ge,c as Ve}from"./dialog-2_FlWSQy.js";import{f as na}from"./TareaService-CZcn_o-m.js";import{A as ta,g as ca,a as sa,b as la,c as da,d as ua,e as ma,f as ha}from"./alert-dialog-Bczf_PEy.js";const ga=a=>({idTipoSolicitud:a.idTipoSolicitud??a.tipoSolicitud??null,idTipoCliente:a.idTipoCliente??a.tipoCliente??null,idTipoDocumento:a.idTipoDocumento??a.tipoDocumento??null,numeroDocumento:a.numeroDocumento||"",nombres:a.nombres||"",apellidoPaterno:a.apellidoPaterno||"",apellidoMaterno:a.apellidoMaterno||"",validar:a.validar||!1,equifax:a.equifax||"",obsEquifax:a.obsEquifax||"",listasControl:a.listasControl||"",obsListasControl:a.obsListasControl||"",continuar:typeof a.continuar=="number"?a.continuar:1});function ni({id:a}){const{notify:i,setSolicitudHabilitada:l}=Ke(),[b,y]=t.useState([]),[n,x]=t.useState([]),[$,F]=t.useState([]),[d,m]=t.useState(null),[S,r]=t.useState(!1),[v,u]=t.useState(!1),[j,C]=t.useState(!1),[c,o]=t.useState({idTipoSolicitud:null,idTipoCliente:null,idTipoDocumento:null,numeroDocumento:"",nombres:"",apellidoPaterno:"",apellidoMaterno:"",validar:!1,equifax:"",obsEquifax:"",listasControl:"",obsListasControl:"",continuar:1}),h=[{id:1,label:"Continuar con la solicitud"},{id:0,label:"Rechazar solicitud"}];t.useEffect(()=>{(async()=>{try{const[f,E,D]=await Promise.all([aa(),ia(),Oe()]);y(f),x(E),F(D)}catch(f){p.error("Error al cargar catálogos: "+f.message)}})()},[]),t.useEffect(()=>{(async()=>{try{const E=(await K(a)).data[0];m(E),o(ga(E.identificacion)),u(E.identificacion.validar)}catch(f){p.error("Error al cargar identificación: "+f.message)}})()},[a]),t.useEffect(()=>{l(c.continuar===1)},[c.continuar,l]);const g=(f,E)=>o(D=>({...D,[f]:E})),w=async()=>{if(!(S||v)){if(!c.idTipoSolicitud||!c.idTipoCliente||!c.idTipoDocumento||!c.numeroDocumento||!c.nombres||!c.apellidoPaterno||!c.apellidoMaterno)return i.error("Por favor llena todos los campos antes de validar."),!1;r(!0),i.info("Iniciando validación...");try{const f=await Ze(c.numeroDocumento);if(f.success){const D=f.resultado;g("equifax",D.error?"Error":D.resultado?"Paso":"Rechazado"),g("obsEquifax",D.observacion||"Sin observación")}else g("equifax","Error"),g("obsEquifax","Error en validación Equifax");const E=await ea({identificacion:c.numeroDocumento,primerNombre:c.nombres.split(" ")[0]||"",segundoNombre:c.nombres.split(" ")[1]||"",primerApellido:c.apellidoPaterno,segundoApellido:c.apellidoMaterno});if(E.success){const D=E.resultado;g("listasControl",D.error?"Error":D.coincidencia?"Rechazado":"Paso"),g("obsListasControl",D.mensaje||"Sin observación")}else g("listasControl","Error"),g("obsListasControl","Error en validación LDS");return u(!0),i.success("Validación completada"),!0}catch{return i.error("Ocurrió un error durante la validación."),!1}finally{r(!1)}}},U=async()=>{if(d){C(!0);try{const f={...d,identificacion:{tipoSolicitud:c.idTipoSolicitud,tipoCliente:c.idTipoCliente,tipoDocumento:c.idTipoDocumento,numeroDocumento:c.numeroDocumento,nombres:c.nombres,apellidoPaterno:c.apellidoPaterno,apellidoMaterno:c.apellidoMaterno,validar:c.validar,equifax:c.equifax,obsEquifax:c.obsEquifax,listasControl:c.listasControl,obsListasControl:c.obsListasControl,continuar:c.continuar}};(await Q(a,f)).success?p.success("Identificación actualizada."):p.error("Error al actualizar identificación.")}catch(f){p.error("Error al guardar: "+f.message)}finally{C(!1)}}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:"Identificación"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(fa,{label:"Validar",checked:c.validar,onChange:async f=>{if(!S&&!v){if(!f)return g("validar",!1);const E=await w();g("validar",E)}}}),S&&e.jsxs("span",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx(Qe,{className:"mr-2 h-4 w-4 animate-spin"}),"Consultando..."]}),v&&e.jsx("button",{onClick:()=>u(!1),className:"text-sm text-gray-200 bg-primary hover:bg-primary/80 hover:text-white px-4 py-1.5 rounded-md ml-4",children:"Editar datos"})]})]}),e.jsx(De,{}),e.jsx(V,{className:"shadow-md rounded-2xl bg-white border border-gray-200 shadow-md",children:e.jsxs(L,{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(ae,{label:"Tipo de solicitud",options:b.map(f=>({id:f.idTipoDeSolicitud,label:f.nombreTipoDeSolicitud})),value:c.idTipoSolicitud,onChange:f=>g("idTipoSolicitud",f),disabled:v}),e.jsx(ae,{label:"Tipo de cliente",options:n.map(f=>({id:f.idTipoCliente,label:f.nombreTipoCliente})),value:c.idTipoCliente,onChange:f=>g("idTipoCliente",f),disabled:v}),e.jsx(ae,{label:"Tipo de documento",options:$.map(f=>({id:f.idTipoIdentificacion,label:f.tipo})),value:c.idTipoDocumento,onChange:f=>g("idTipoDocumento",f),disabled:v}),e.jsx(W,{label:"Número de identificación",value:c.numeroDocumento,onChange:f=>g("numeroDocumento",f.target.value),disabled:v}),e.jsx(W,{label:"Nombres",value:c.nombres,onChange:f=>g("nombres",f.target.value),disabled:v}),e.jsx(W,{label:"Apellido paterno",value:c.apellidoPaterno,onChange:f=>g("apellidoPaterno",f.target.value),disabled:v}),e.jsx(W,{label:"Apellido materno",value:c.apellidoMaterno,onChange:f=>g("apellidoMaterno",f.target.value),disabled:v})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(J,{onClick:U,disabled:j,className:"text-gray-200 bg-primary hover:bg-primary/80",children:j?"Guardando...":"Guardar Identificación"})})]})}),c.validar&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:"Validación"}),e.jsx(De,{}),e.jsx(V,{className:"shadow-md rounded-2xl bg-white border border-gray-200 shadow-md",children:e.jsx(L,{className:"p-6 space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(W,{label:"Identidad (Equifax)",value:c.equifax,disabled:!0}),e.jsx(ke,{label:"Observación Equifax",value:c.obsEquifax,disabled:!0}),e.jsx(W,{label:"Listas de Control (LDS)",value:c.listasControl,disabled:!0}),e.jsx(ke,{label:"Observación LDS",value:c.obsListasControl,disabled:!0}),e.jsx(ae,{label:"Continuar",value:c.continuar,onChange:f=>g("continuar",Number(f)),options:h,full:!0,disabled:c.equifax==="Rechazado"||c.listasControl==="Rechazado"})]})})})]})]})}function W({label:a,value:i,onChange:l,disabled:b}){return e.jsxs("div",{className:"space-y-1",children:[e.jsx(P,{className:"text-sm text-gray-700 font-medium",children:a}),e.jsx(z,{value:i,onChange:l,disabled:b,className:"text-sm border-black",placeholder:a})]})}function ae({label:a,value:i,onChange:l,options:b,full:y=!1,disabled:n}){return e.jsxs("div",{className:`space-y-1 ${y?"md:col-span-2":""}`,children:[e.jsx(P,{className:"text-sm text-gray-700 font-medium",children:a}),e.jsxs(A,{value:i!=null?String(i):void 0,onValueChange:x=>l(Number(x)),disabled:n,children:[e.jsx(k,{className:"text-sm border-black",children:e.jsx(R,{placeholder:a})}),e.jsx(I,{className:"bg-white",children:b.map(x=>e.jsx(N,{value:String(x.id),children:x.label},x.id))})]})]})}function fa({label:a,checked:i,onChange:l}){return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(X,{checked:i,onCheckedChange:l,className:`
            peer
            inline-flex
            h-6 w-11 shrink-0
            cursor-pointer
            items-center
            rounded-full
            border
            border-black
            transition-colors
            duration-200
            ease-in-out
            ${i?"bg-primary":"bg-gray-300"}
          `}),e.jsx("span",{className:`
            pointer-events-none
            absolute
            left-0.5 top-0.5
            h-5 w-5
            transform
            rounded-full
            bg-white
            shadow
            transition-transform
            duration-200
            ease-in-out
            ${i?"translate-x-5":"translate-x-0"}
          `})]}),e.jsx(P,{className:"text-sm font-medium text-gray-700",children:a})]})}function ke({label:a,value:i,disabled:l}){return e.jsxs("div",{className:"space-y-1",children:[e.jsx(P,{className:"text-sm text-gray-700 font-medium",children:a}),e.jsx("textarea",{rows:3,value:i,disabled:l,placeholder:a,className:"w-full text-sm rounded-md border border-gray-700 px-3 py-2 resize-none"})]})}const be=async a=>{if(!a.ok){const i=await a.text();throw new Error(i||"Error en la solicitud")}return await a.json()},je=()=>{var i;return{"Content-Type":"application/json",Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("user")))==null?void 0:i.token}`}},xa=async()=>{const a=await fetch(`${T}/vista/asesorcomercial`,{headers:je()});return be(a)},pa=async()=>{const a=await fetch(`${T}/JustificativoTransaccion`,{headers:je()});return be(a)},ba=async()=>{const a=await fetch(`${T}/OrigenCliente`,{headers:je()});return be(a)};function ti(){const{id:a}=he();ze();const[i,l]=t.useState(null),[b,y]=t.useState([]),[n,x]=t.useState([]),[$,F]=t.useState([]),[d,m]=t.useState([]),[S,r]=t.useState(!0),[v,u]=t.useState(!1),[j,C]=t.useState({idAsesorComercial:"",idJustificativoTransaccion:"",idProyeccionSeleccionada:"",origenFondos:"",enviarProyeccion:!1,clienteAcepta:!1});t.useEffect(()=>{(async()=>{var g,w,U,f,E;r(!0);try{if(a){const _=(await K(a)).data[0];l(_),C({idAsesorComercial:((g=_.proyeccion)==null?void 0:g.idAsesorComercial)||"",idJustificativoTransaccion:((w=_.proyeccion)==null?void 0:w.idJustificativoTransaccion)||"",idProyeccionSeleccionada:((U=_.proyeccion)==null?void 0:U.idProyeccionSeleccionada)||"",origenFondos:((f=_.proyeccion)==null?void 0:f.origenFondos)||"",enviarProyeccion:!1,clienteAcepta:((E=_.proyeccion)==null?void 0:E.clienteAcepta)||!1})}const[D,ye,le,de]=await Promise.all([ra(a),xa(),pa(),ba()]);y(D.proyecciones||[]),x(ye||[]),F(le||[]),m(de||[])}catch(D){console.error(D),p.error("Error al cargar los datos de la solicitud: "+D.message)}finally{r(!1)}})()},[a]);const c=async()=>{if(i)try{r(!0);const h={...i,identificacion:Z(i.identificacion),proyeccion:{...j,enviarProyeccion:!1}};(await Q(a,h)).success?p.success("Datos guardados exitosamente."):p.error("Error al guardar los datos.")}catch(h){console.error(h),p.error("Error al guardar los datos: "+h.message)}finally{r(!1)}},o=[{key:"proyeccionNombre",label:"Nombre"},{key:"tasa",label:"Tasa (%)"},{key:"capital",label:"Capital"},{key:"fechaInicial",label:"Fecha Inicial"},{key:"idUsuarioCreacion",label:"Usuario Creador"}];return e.jsx("div",{className:"space-y-6 px-4 sm:px-6 py-6",children:S?e.jsx("p",{children:"Cargando datos..."}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Proyecciones vinculadas"}),e.jsx(V,{children:e.jsx(L,{className:"space-y-6 px-4 sm:px-6 py-6",children:e.jsx(ge,{columns:o,data:b,mostrarAgregarNuevo:!0,onAgregarNuevoClick:()=>u(!0),mostrarEditar:!1,mostrarEliminar:!1})})}),e.jsx(V,{children:e.jsxs(L,{className:"p-6 space-y-6",children:[e.jsx(J,{onClick:c,disabled:S,className:"text-white bg-primary hover:bg-primary/85",children:"Guardar datos"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(ee,{label:"Asesor comercial",children:e.jsxs(A,{value:String(j.idAsesorComercial),onValueChange:h=>C({...j,idAsesorComercial:h}),children:[e.jsx(k,{className:"bg-white border border-black",children:e.jsx(R,{placeholder:"-Selecciona un asesor-"})}),e.jsx(I,{className:"bg-white",children:n.map(h=>e.jsx(N,{value:String(h.idUsuario),children:h.nombreCompleto},h.idUsuario))})]})}),e.jsx(ee,{label:"Justificativo de transacción",children:e.jsxs(A,{value:String(j.idJustificativoTransaccion),onValueChange:h=>C({...j,idJustificativoTransaccion:h}),children:[e.jsx(k,{className:"bg-white border border-black",children:e.jsx(R,{placeholder:"-Selecciona un justificativo-"})}),e.jsx(I,{className:"bg-white",children:$.map(h=>e.jsx(N,{value:String(h.idJustificativoTransaccion),children:h.nombre},h.idJustificativoTransaccion))})]})}),e.jsx(ee,{label:"Proyección seleccionada",children:e.jsxs(A,{value:String(j.idProyeccionSeleccionada),onValueChange:h=>C({...j,idProyeccionSeleccionada:h}),children:[e.jsx(k,{className:"bg-white border border-black",children:e.jsx(R,{placeholder:"-Selecciona una proyección-"})}),e.jsx(I,{className:"bg-white",children:b.map(h=>e.jsx(N,{value:String(h.idProyeccion),children:h.proyeccionNombre},h.idProyeccion))})]})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(ee,{label:"Origen de fondos",children:e.jsx("textarea",{className:"w-full border border-black rounded-md px-3 py-2 text-sm",rows:3,placeholder:"Describe el origen de los fondos",value:j.origenFondos,onChange:h=>C({...j,origenFondos:h.target.value})})})}),e.jsx(ee,{label:"Aceptación del cliente",children:e.jsx(ja,{label:j.clienteAcepta?"El Cliente Acepta":"El Cliente No Acepta",checked:j.clienteAcepta,onChange:h=>C({...j,clienteAcepta:h})})})]})]})}),e.jsx(fe,{open:v,onOpenChange:u,children:e.jsxs(xe,{className:"w-full max-w-4xl max-h-[calc(100vh-4rem)] overflow-y-auto p-4",children:[e.jsx(oa,{}),e.jsx(pe,{children:e.jsx(J,{variant:"outline",onClick:()=>u(!1),children:"Cancelar"})})]})})]})})}function ee({label:a,children:i}){return e.jsxs("div",{className:"space-y-1",children:[e.jsx(P,{className:"text-sm text-gray-700 font-medium",children:a}),i]})}function ja({label:a,checked:i,onChange:l}){return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(X,{checked:i,onCheckedChange:l,className:`
            peer
            inline-flex
            h-6 w-11 shrink-0
            cursor-pointer
            items-center
            rounded-full
            border
            border-gray-400
            transition-colors
            duration-200
            ease-in-out
            ${i?"bg-primary":"bg-gray-300"}
          `}),e.jsx("span",{className:`
            pointer-events-none
            absolute
            left-0.5 top-0.5
            h-5 w-5
            transform
            rounded-full
            bg-white
            shadow
            transition-transform
            duration-200
            ease-in-out
            ${i?"translate-x-5":"translate-x-0"}
          `})]}),e.jsx(P,{className:"text-sm font-light text-gray-700",children:a})]})}const oe=()=>{var i;return{"Content-Type":"application/json",Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("user")))==null?void 0:i.token}`}},re=async a=>{if(!a.ok){const i=await a.text();throw new Error(i||"Error en la solicitud")}return await a.json()},ue=async a=>{const i=await fetch(`${T}/vista/referencia/filtrar?por=idSolicitudInversion&id=${a}`,{headers:oe()});return re(i)},va=async a=>{const i=await fetch(`${T}/referencia`,{method:"POST",headers:oe(),body:JSON.stringify(a)});return re(i)},Ca=async(a,i)=>{const l=await fetch(`${T}/referencia/${a}`,{method:"PUT",headers:oe(),body:JSON.stringify(i)});return re(l)},ya=async a=>{const i=await fetch(`${T}/referencia/${a}`,{method:"DELETE",headers:oe()});return re(i)},Sa=async a=>{if(!a.ok){const i=await a.text();throw new Error(i||"Error en la solicitud")}return await a.json()},Na=()=>{var i;return{"Content-Type":"application/json",Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("user")))==null?void 0:i.token}`}},Ea=async()=>{const a=await fetch(`${T}/TipoReferencia`,{headers:Na()});return Sa(a)},ve=()=>{var i;return{"Content-Type":"application/json",Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("user")))==null?void 0:i.token}`}},Ce=async a=>{if(!a.ok){const i=await a.text();throw new Error(i||"Error en la solicitud")}return a.json()},Ta=async()=>{const a=await fetch(`${T}/Nacionalidad`,{headers:ve()});return Ce(a)},wa=async()=>{const a=await fetch(`${T}/Profesion`,{headers:ve()});return Ce(a)},Pa=async()=>{const a=await fetch(`${T}/Etnia`,{headers:ve()});return Ce(a)};function ci(){var Ne;const{user:a}=Be(),{id:i}=he();ze();const[l,b]=t.useState(!0),[y,n]=t.useState([]),[x,$]=t.useState([]),[F,d]=t.useState([]),[m,S]=t.useState(null),[r,v]=t.useState({fechaNacimiento:"",genero:"",estadoCivil:"",nivelAcademico:"",numeroCargasFamiliares:"",nacionalidad:"",profesion:"",etnia:"",paisNacimiento:"",provinciaNacimiento:"",ciudadNacimiento:""});t.useEffect(()=>{(async()=>{var B,q,Ee,Te;try{const Pe=(await K(i)).data[0];S(Pe);const M=Pe.datosGenerales;v({fechaNacimiento:M.fechaNacimiento?M.fechaNacimiento.split("T")[0]:"",genero:((B=M.idGenero)==null?void 0:B.toString())||"",estadoCivil:((q=M.idEstadoCivil)==null?void 0:q.toString())||"",nivelAcademico:((Ee=M.idNivelAcademico)==null?void 0:Ee.toString())||"",numeroCargasFamiliares:((Te=M.numeroCargasFamiliares)==null?void 0:Te.toString())||"",nacionalidad:M.idNacionalidad||"",profesion:M.idProfesion||"",etnia:M.idEtnia||"",paisNacimiento:"",provinciaNacimiento:"",ciudadNacimiento:""});const[He,_e,Ye]=await Promise.all([Pa(),Ta(),wa()]);n(He),$(_e),d(Ye)}catch(we){p.error("Error al cargar datos generales: "+we.message)}finally{b(!1)}})()},[i]);const u=async()=>{if(m){b(!0);try{const s={...m,identificacion:Z(m.identificacion),datosGenerales:{...m.datosGenerales,fechaNacimiento:r.fechaNacimiento,idGenero:parseInt(r.genero)||null,idEstadoCivil:parseInt(r.estadoCivil)||null,idNivelAcademico:parseInt(r.nivelAcademico)||null,numeroCargasFamiliares:parseInt(r.numeroCargasFamiliares)||0,idNacionalidad:r.nacionalidad,idProfesion:r.profesion,idEtnia:r.etnia}};(await Q(i,s)).success?p.success("Datos generales actualizados."):p.error("Error al actualizar datos generales.")}catch(s){p.error("Error al guardar datos generales: "+s.message)}finally{b(!1)}}},[j,C]=t.useState([]),[c,o]=t.useState([]),[h,g]=t.useState(!1),[w,U]=t.useState({idSolicitudInversion:Number(i),idTipoReferencia:"",nombre:"",direccion:"",telefonoCelular:"",fechaCreacion:new Date().toISOString(),idUsuarioPropietario:a.idUsuario}),[f,E]=t.useState(!1),[D,ye]=t.useState(null);t.useEffect(()=>{const s=async()=>{try{const q=await ue(i);o(q)}catch(q){console.error(q)}},B=async()=>{try{const q=await Ea();C(q)}catch(q){console.error(q)}};s(),B()},[i]);const le=()=>{E(!1),U({idSolicitudInversion:Number(i),idTipoReferencia:"",nombre:"",direccion:"",telefonoCelular:"",fechaCreacion:new Date().toISOString(),idUsuarioPropietario:a.idUsuario}),g(!0)},de=s=>{U({idReferencia:s.idReferencia,idSolicitudInversion:Number(i),idTipoReferencia:s.idTipoReferencia,nombre:s.nombreReferencia,direccion:s.direccion,telefonoCelular:s.telefonoCelular,telefonoFijo:s.telefonoFijo||"",fechaCreacion:s.fechaCreacion,idUsuarioPropietario:a.idUsuario}),E(!0),g(!0)},Se=async s=>{if(window.confirm(`¿Eliminar "${s.nombreReferencia}"?`))try{await ya(s.idReferencia),p.success("Referencia eliminada");const B=await ue(i);o(B)}catch{p.error("No se pudo eliminar la referencia")}},_=[{key:"idReferencia",label:"ID Referencia",render:s=>e.jsx("div",{className:"text-end font-semibold",children:s})},{key:"nombreReferencia",label:"Nombre Referencia"},{key:"nombreTipoReferencia",label:"Tipo Referencia"},{key:"telefonoCelular",label:"Teléfono Celular"},{key:"direccion",label:"Dirección"},{key:"fechaCreacion",label:"Fecha de Creación"}];return l?e.jsx("p",{children:"Cargando datos generales..."}):e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Datos generales"}),e.jsx(V,{children:e.jsxs(L,{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex justify-end",children:e.jsx(J,{onClick:u,disabled:l,className:"bg-primary text-gray-200 hover:text-white hover:bg-primary/80 hover:shadow-md",children:l?"Guardando...":"Guardar Datos Generales"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(G,{label:"Fecha de nacimiento",children:e.jsx(z,{type:"date",value:r.fechaNacimiento,onChange:s=>v({...r,fechaNacimiento:s.target.value})})}),e.jsx(G,{label:"Género",children:e.jsxs(A,{value:r.genero,onValueChange:s=>v({...r,genero:s}),children:[e.jsx(k,{className:"bg-white border border-gray-700",children:e.jsx(R,{placeholder:"Seleccionar..."})}),e.jsxs(I,{className:"bg-white",children:[e.jsx(N,{value:"1",children:"Masculino"}),e.jsx(N,{value:"2",children:"Femenino"}),e.jsx(N,{value:"3",children:"Otro"})]})]})}),e.jsx(G,{label:"Estado civil",children:e.jsxs(A,{value:r.estadoCivil,onValueChange:s=>v({...r,estadoCivil:s}),children:[e.jsx(k,{className:"bg-white border border-gray-700",children:e.jsx(R,{placeholder:"Seleccionar..."})}),e.jsxs(I,{className:"bg-white",children:[e.jsx(N,{value:"1",children:"Soltero"}),e.jsx(N,{value:"2",children:"Casado"}),e.jsx(N,{value:"3",children:"Divorciado"})]})]})}),e.jsx(G,{label:"Nivel académico",children:e.jsxs(A,{value:r.nivelAcademico,onValueChange:s=>v({...r,nivelAcademico:s}),children:[e.jsx(k,{className:"bg-white border border-gray-700",children:e.jsx(R,{placeholder:"Seleccionar..."})}),e.jsxs(I,{className:"bg-white",children:[e.jsx(N,{value:"1",children:"Primaria"}),e.jsx(N,{value:"2",children:"Secundaria"}),e.jsx(N,{value:"3",children:"Universitaria"})]})]})}),e.jsx(G,{label:"Nacionalidad",children:e.jsxs(A,{value:r.nacionalidad,onValueChange:s=>v({...r,nacionalidad:s}),children:[e.jsx(k,{className:"bg-white border border-gray-700",children:e.jsx(R,{placeholder:"Seleccionar..."})}),e.jsx(I,{className:"bg-white",children:x.map(s=>e.jsx(N,{value:s.idNacionalidad,children:s.nombre},s.idNacionalidad))})]})}),e.jsx(G,{label:"Profesión",children:e.jsxs(A,{value:r.profesion,onValueChange:s=>v({...r,profesion:s}),children:[e.jsx(k,{className:"bg-white border border-gray-700",children:e.jsx(R,{placeholder:"Seleccionar..."})}),e.jsx(I,{className:"bg-white",children:F.map(s=>e.jsx(N,{value:s.idProfesion,children:s.nombre},s.idProfesion))})]})}),e.jsx(G,{label:"Etnia",children:e.jsxs(A,{value:r.etnia,onValueChange:s=>v({...r,etnia:s}),children:[e.jsx(k,{className:"bg-white border border-gray-700",children:e.jsx(R,{placeholder:"Seleccionar..."})}),e.jsx(I,{className:"bg-white",children:y.map(s=>e.jsx(N,{value:s.idEtnia,children:s.nombre},s.idEtnia))})]})})]})]})}),e.jsx("div",{children:e.jsx(V,{children:e.jsx(L,{children:e.jsx(ge,{columns:_,data:c,mostrarEditar:!0,mostrarAgregarNuevo:!0,mostrarEliminar:!0,onAgregarNuevoClick:le,onEditarClick:de,onEliminarClick:Se})})})}),e.jsx(fe,{open:h,onOpenChange:g,children:e.jsxs(xe,{children:[e.jsx(Ge,{children:e.jsx(Ve,{children:f?"Editar referencia":"Agregar nueva referencia"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(G,{label:"Nombre",children:e.jsx(z,{value:w.nombre,onChange:s=>U({...w,nombre:s.target.value})})}),e.jsx(G,{label:"Dirección",children:e.jsx(z,{value:w.direccion,onChange:s=>U({...w,direccion:s.target.value})})}),e.jsx(G,{label:"Teléfono Celular",children:e.jsx(z,{value:w.telefonoCelular,onChange:s=>U({...w,telefonoCelular:s.target.value})})}),e.jsx(G,{label:"Tipo de Referencia",children:e.jsxs(A,{value:(Ne=w.idTipoReferencia)==null?void 0:Ne.toString(),onValueChange:s=>U({...w,idTipoReferencia:Number(s)}),children:[e.jsx(k,{className:"bg-white border border-gray-700",children:e.jsx(R,{placeholder:"Seleccionar..."})}),e.jsx(I,{className:"bg-white",children:j.map(s=>e.jsx(N,{value:s.idTipoReferencia.toString(),children:s.nombre},s.idTipoReferencia))})]})})]}),e.jsx(pe,{className:"pt-4",children:e.jsx(J,{className:"text-gray-300 hover:text-white",onClick:async()=>{const s={...w,fechaCreacion:new Date().toISOString()};try{f?(await Ca(w.idReferencia,s),p.success("Referencia actualizada",{description:`Se actualizó ${w.nombre}`})):(await va(s),p.success("Referencia creada",{description:`Se agregó ${w.nombre}`}));const B=await ue(i);o(B),g(!1),E(!1),U({idSolicitudInversion:Number(i),idTipoReferencia:"",nombre:"",direccion:"",telefonoCelular:"",fechaCreacion:new Date().toISOString(),idUsuarioPropietario:a.idUsuario})}catch(B){console.error("Error al guardar referencia:",B),p.error("No se pudo guardar la referencia.")}},children:f?"Actualizar":"Crear"})})]})}),e.jsx(We,{})]})}function G({label:a,children:i}){return e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:a}),i]})}const Le=async a=>{if(!a.ok){const i=await a.text();throw new Error(i||"Error en la solicitud")}return await a.json()},Je=()=>{var i;return{"Content-Type":"application/json",Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("user")))==null?void 0:i.token}`}},Da=async()=>{const a=await fetch(`${T}/ActividadEconomicaPrincipal`,{headers:Je()});return Le(a)},Aa=async()=>{const a=await fetch(`${T}/ActividadEconomicaLugarTrabajo`,{headers:Je()});return Le(a)};function si({id:a}){const[i,l]=t.useState(!0),[b,y]=t.useState(null),[n,x]=t.useState([]),[$,F]=t.useState([]),[d,m]=t.useState({idActividadEconomicaPrincipal:"",idActividadEconomicaLugarTrabajo:"",lugarTrabajo:"",correoTrabajo:"",otraActividadEconomica:"",cargo:"",antiguedad:"",telefonoTrabajo:"",fechaInicioActividad:"",direccionTrabajo:"",referenciaDireccionTrabajo:"",isPEP:!1});t.useEffect(()=>{(async()=>{l(!0);try{const u=(await K(a)).data[0];y(u),m({idActividadEconomicaPrincipal:u.actividadEconomica.idActividadEconomicaPrincipal||"",idActividadEconomicaLugarTrabajo:u.actividadEconomica.idActividadEconomicaLugarTrabajo||"",lugarTrabajo:u.actividadEconomica.lugarTrabajo||"",correoTrabajo:u.actividadEconomica.correoTrabajo||"",otraActividadEconomica:u.actividadEconomica.otraActividadEconomica||"",cargo:u.actividadEconomica.cargo||"",antiguedad:u.actividadEconomica.antiguedad||"",telefonoTrabajo:u.actividadEconomica.telefonoTrabajo||"",fechaInicioActividad:u.actividadEconomica.fechaInicioActividad?u.actividadEconomica.fechaInicioActividad.split("T")[0]:"",direccionTrabajo:u.actividadEconomica.direccionTrabajo||"",referenciaDireccionTrabajo:u.actividadEconomica.referenciaDireccionTrabajo||"",isPEP:u.actividadEconomica.esPEP||!1});const[j,C]=await Promise.all([Da(),Aa()]),c=j.map(h=>({id:String(h.idActividadEconomicaPrincipal),nombre:h.nombre})),o=C.map(h=>({id:String(h.idActividadEconomicaLugarTrabajo),nombre:h.nombre}));x(c),F(o)}catch(v){p.error("Error al cargar datos: "+v.message)}finally{l(!1)}})()},[a]);const S=async()=>{if(b)try{const r={...b,identificacion:Z(b.identificacion),actividadEconomica:{...d,esPEP:d.isPEP}};console.log(r),l(!0),(await Q(a,r)).success?p.success("Datos guardados exitosamente."):p.error("Error al guardar los datos.")}catch(r){p.error("Error al guardar los datos: "+r.message)}finally{l(!1)}};return e.jsx("div",{className:"space-y-6 p-6",children:i?e.jsx("p",{children:"Cargando datos..."}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Actividad económica"}),e.jsx(J,{onClick:S,disabled:i,className:"text-white",children:"Guardar datos"}),e.jsx(V,{children:e.jsx(L,{className:"p-6 space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(Re,{label:"Actividad económica principal",options:n,value:d.idActividadEconomicaPrincipal,onChange:r=>m({...d,idActividadEconomicaPrincipal:r})}),e.jsx(Re,{label:"Actividad económica del lugar de trabajo",options:$,value:d.idActividadEconomicaLugarTrabajo,onChange:r=>m({...d,idActividadEconomicaLugarTrabajo:r})}),e.jsx(H,{label:"Lugar de trabajo",value:d.lugarTrabajo,onChange:r=>m({...d,lugarTrabajo:r.target.value})}),e.jsx(H,{label:"Otra actividad económica",value:d.otraActividadEconomica,onChange:r=>m({...d,otraActividadEconomica:r.target.value})}),e.jsx(H,{label:"Cargo",value:d.cargo,onChange:r=>m({...d,cargo:r.target.value})}),e.jsx(H,{label:"Correo electrónico del trabajo",value:d.correoTrabajo,onChange:r=>m({...d,correoTrabajo:r.target.value})}),e.jsx(H,{label:"Antigüedad (años)",value:d.antiguedad,onChange:r=>m({...d,antiguedad:r.target.value})}),e.jsx(H,{label:"Teléfono del trabajo",value:d.telefonoTrabajo,onChange:r=>m({...d,telefonoTrabajo:r.target.value})}),e.jsx(H,{label:"Fecha de inicio",type:"date",value:d.fechaInicioActividad,onChange:r=>m({...d,fechaInicioActividad:r.target.value})}),e.jsx(H,{label:"Dirección del trabajo",value:d.direccionTrabajo,onChange:r=>m({...d,direccionTrabajo:r.target.value})}),e.jsx(H,{label:"Referencia de la dirección del trabajo",value:d.referenciaDireccionTrabajo,onChange:r=>m({...d,referenciaDireccionTrabajo:r.target.value})}),e.jsx(ka,{label:"Es PEP",checked:d.isPEP,onChange:r=>m({...d,isPEP:r})})]})})})]})})}function H({label:a,value:i,onChange:l,type:b="text"}){return e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:a}),e.jsx(z,{placeholder:"---",type:b,value:i,onChange:l})]})}function Re({label:a,options:i,value:l,onChange:b}){return e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:a}),e.jsxs(A,{value:String(l),onValueChange:b,children:[e.jsx(k,{className:"bg-white border border-gray-700",children:e.jsx(R,{placeholder:"Seleccione una opción"})}),e.jsx(I,{className:"bg-white",children:i.map(y=>e.jsx(N,{value:String(y.id),children:y.nombre},y.id))})]})]})}function ka({label:a,checked:i,onChange:l}){return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(X,{checked:i,onCheckedChange:l,className:`
            peer
            inline-flex
            h-6 w-11 shrink-0
            cursor-pointer
            items-center
            rounded-full
            border
            border-gray-400
            transition-colors
            duration-200
            ease-in-out
            ${i?"bg-primary":"bg-gray-300"}
          `}),e.jsx("span",{className:`
            pointer-events-none
            absolute
            left-0.5 top-0.5
            h-5 w-5
            transform
            rounded-full
            bg-white
            shadow
            transition-transform
            duration-200
            ease-in-out
            ${i?"translate-x-5":"translate-x-0"}
          `})]}),e.jsx(P,{className:"text-sm font-medium text-gray-700",children:a})]})}const ne=()=>{var i;return{"Content-Type":"application/json",Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("user")))==null?void 0:i.token}`}},te=async a=>{if(!a.ok){const i=await a.text();throw new Error(i||"Error en la solicitud")}return a.json()},Ra=async()=>{const a=await fetch(`${T}/TipoVia`,{headers:ne()});return te(a)},Ia=async()=>{const a=await fetch(`${T}/Pais`,{headers:ne()});return te(a)},Ie=async a=>{const i=await fetch(`${T}/Provincia/por-pais/${a}`,{headers:ne()});return te(i)},$e=async a=>{const i=await fetch(`${T}/Ciudad/por-provincia/${a}`,{headers:ne()});return te(i)};function li({id:a}){const[i,l]=t.useState(!0),[b,y]=t.useState(null),[n,x]=t.useState({correoElectronico:"",otroTelefono:"",telefonoCelular:"",telefonoFijo:"",idTipoVia:"",callePrincipal:"",numeroDomicilio:"",calleSecundaria:"",referenciaDomicilio:"",sectorBarrio:"",tiempoResidencia:"",idPaisResidencia:"",idProvinciaResidencia:"",idCiudadResidencia:"",residenteOtroPais:!1,contribuyenteEEUU:!1,numeroIdentificacionOtroPais:"",numeroIdentificacionEEUU:""}),[$,F]=t.useState([]),[d,m]=t.useState([]),[S,r]=t.useState([]),[v,u]=t.useState([]);t.useEffect(()=>{(async()=>{try{const g=(await K(a)).data[0];y(g),x({correoElectronico:g.contactoUbicacion.correoElectronico||"",otroTelefono:g.contactoUbicacion.otroTelefono||"",telefonoCelular:g.contactoUbicacion.telefonoCelular||"",telefonoFijo:g.contactoUbicacion.telefonoFijo||"",callePrincipal:g.contactoUbicacion.callePrincipal||"",numeroDomicilio:g.contactoUbicacion.numeroDomicilio||"",calleSecundaria:g.contactoUbicacion.calleSecundaria||"",referenciaDomicilio:g.contactoUbicacion.referenciaDomicilio||"",sectorBarrio:g.contactoUbicacion.sectorBarrio||"",tiempoResidencia:g.contactoUbicacion.tiempoResidencia||"",idTipoVia:g.contactoUbicacion.idTipoVia||"",idPaisResidencia:g.contactoUbicacion.idPaisResidencia||"",idProvinciaResidencia:g.contactoUbicacion.idProvinciaResidencia||"",idCiudadResidencia:g.contactoUbicacion.idCiudadResidencia||"",residenteOtroPais:g.contactoUbicacion.residenteOtroPais||!1,contribuyenteEEUU:g.contactoUbicacion.contribuyenteEEUU||!1,numeroIdentificacionOtroPais:g.contactoUbicacion.numeroIdentificacionOtroPais||"",numeroIdentificacionEEUU:g.contactoUbicacion.numeroIdentificacionEEUU||""});const[w,U]=await Promise.all([Ia(),Ra()]);if(F(w),u(U),g.contactoUbicacion.idPaisResidencia){const f=await Ie(g.contactoUbicacion.idPaisResidencia);if(m(f),g.contactoUbicacion.idProvinciaResidencia){const E=await $e(g.contactoUbicacion.idProvinciaResidencia);r(E)}}}catch(h){p.error("Error al cargar contacto: "+h.message)}finally{l(!1)}})()},[a]);const j=async()=>{if(b)try{l(!0);const o={...b,identificacion:Z(b.identificacion),contactoUbicacion:n};(await Q(a,o)).success?p.success("Contacto actualizado."):p.error("Error al actualizar contacto.")}catch(o){p.error("Error al guardar: "+o.message)}finally{l(!1)}},C=async o=>{x({...n,idPaisResidencia:o,idProvinciaResidencia:"",idCiudadResidencia:""});const h=await Ie(o);m(h),r([])},c=async o=>{x({...n,idProvinciaResidencia:o,idCiudadResidencia:""});const h=await $e(o);r(h)};return i?e.jsx("p",{children:"Cargando contacto..."}):e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Contacto y Ubicación"}),e.jsx(J,{onClick:j,disabled:i,className:"text-white",children:"Guardar datos"}),e.jsx(V,{children:e.jsxs(L,{className:"p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(O,{label:"Correo electrónico",value:n.correoElectronico,onChange:o=>x({...n,correoElectronico:o.target.value})}),e.jsx(O,{label:"Otro teléfono",value:n.otroTelefono,onChange:o=>x({...n,otroTelefono:o.target.value})}),e.jsx(O,{label:"Teléfono celular",value:n.telefonoCelular,onChange:o=>x({...n,telefonoCelular:o.target.value})}),e.jsx(O,{label:"Teléfono fijo",value:n.telefonoFijo,onChange:o=>x({...n,telefonoFijo:o.target.value})}),e.jsx(ie,{label:"Tipo de vía",children:e.jsxs(A,{value:n.idTipoVia,onValueChange:o=>x({...n,idTipoVia:o}),children:[e.jsx(k,{className:"border border-black",children:e.jsx(R,{placeholder:"Seleccionar tipo de vía"})}),e.jsx(I,{children:v.map(o=>e.jsx(N,{value:o.idTipoVia,children:o.nombre},o.idTipoVia))})]})}),e.jsx(O,{label:"Calle principal",value:n.callePrincipal,onChange:o=>x({...n,callePrincipal:o.target.value})}),e.jsx(O,{label:"Número de domicilio",value:n.numeroDomicilio,onChange:o=>x({...n,numeroDomicilio:o.target.value})}),e.jsx(O,{label:"Calle secundaria",value:n.calleSecundaria,onChange:o=>x({...n,calleSecundaria:o.target.value})}),e.jsx(O,{label:"Referencia",value:n.referenciaDomicilio,onChange:o=>x({...n,referenciaDomicilio:o.target.value})}),e.jsx(O,{label:"Sector / Barrio",value:n.sectorBarrio,onChange:o=>x({...n,sectorBarrio:o.target.value})}),e.jsx(O,{label:"Tiempo de residencia (años)",type:"number",value:n.tiempoResidencia,onChange:o=>x({...n,tiempoResidencia:o.target.value})}),e.jsx(ie,{label:"País de residencia",children:e.jsxs(A,{value:n.idPaisResidencia,onValueChange:C,children:[e.jsx(k,{className:"border border-black",children:e.jsx(R,{placeholder:"Seleccionar país"})}),e.jsx(I,{children:$.map(o=>e.jsx(N,{value:o.idPais,children:o.nombre},o.idPais))})]})}),e.jsx(ie,{label:"Provincia",children:e.jsxs(A,{disabled:!n.idPaisResidencia,value:n.idProvinciaResidencia,onValueChange:c,children:[e.jsx(k,{className:"border border-black",children:e.jsx(R,{placeholder:"Seleccionar provincia"})}),e.jsx(I,{children:d.map(o=>e.jsx(N,{value:o.idProvincia,children:o.nombre},o.idProvincia))})]})}),e.jsx(ie,{label:"Ciudad",children:e.jsxs(A,{disabled:!n.idProvinciaResidencia,value:n.idCiudadResidencia,onValueChange:o=>x({...n,idCiudadResidencia:o}),children:[e.jsx(k,{className:"border border-black",children:e.jsx(R,{placeholder:"Seleccionar ciudad"})}),e.jsx(I,{children:S.map(o=>e.jsx(N,{value:o.idCiudad,children:o.nombre},o.idCiudad))})]})}),e.jsx(Ue,{label:"Residente otro país",checked:n.residenteOtroPais,onChange:o=>x({...n,residenteOtroPais:o})}),e.jsx(Ue,{label:"Contribuyente EEUU",checked:n.contribuyenteEEUU,onChange:o=>x({...n,contribuyenteEEUU:o})}),e.jsx(O,{label:"Número de identificación (Otro País)",value:n.numeroIdentificacionOtroPais,onChange:o=>x({...n,numeroIdentificacionOtroPais:o.target.value})}),e.jsx(O,{label:"Número de Identificación(EE.UU.)",value:n.numeroIdentificacionEEUU,onChange:o=>x({...n,numeroIdentificacionEEUU:o.target.value})})]})})]})}function O({label:a,value:i,onChange:l,type:b="text"}){return e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:a}),e.jsx(z,{placeholder:"---",type:b,value:i,onChange:l})]})}function Ue({label:a,checked:i,onChange:l}){return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(X,{checked:i,onCheckedChange:l,className:`
            peer
            inline-flex
            h-6 w-11 shrink-0
            cursor-pointer
            items-center
            rounded-full
            border
            border-gray-700
            transition-colors
            duration-200
            ease-in-out
            ${i?"bg-primary":"bg-gray-300"}
          `}),e.jsx("span",{className:`
            pointer-events-none
            absolute
            left-0.5 top-0.5
            h-5 w-5
            transform
            rounded-full
            bg-white
            shadow
            transition-transform
            duration-200
            ease-in-out
            ${i?"translate-x-5":"translate-x-0"}
          `})]}),e.jsx(P,{className:"text-sm font-medium text-gray-700",children:a})]})}function ie({label:a,children:i}){return e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:a}),i]})}const qe=()=>{var i;return{"Content-Type":"application/json",Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("user")))==null?void 0:i.token}`}},Me=async a=>{if(!a.ok){const i=await a.text();throw new Error(i||"Error en la solicitud")}return a.json()},$a=async()=>{const a=await fetch(`${T}/Banco`,{headers:qe()});return Me(a)},Ua=async()=>{const a=await fetch(`${T}/TipoCuenta`,{headers:qe()});return Me(a)};function di({id:a}){const[i,l]=t.useState(!0),[b,y]=t.useState(null),[n,x]=t.useState({idBanco:"",bancoNombre:"",idTipoCuenta:"",nombreTipoCuenta:"",numeroCuenta:""}),[$,F]=t.useState([]),[d,m]=t.useState([]);t.useEffect(()=>{(async()=>{try{const u=(await K(a)).data[0],j=await $a(),C=await Ua();y(u),x({idBanco:u.banco.idBanco??"",bancoNombre:u.banco.bancoNombre??"",idTipoCuenta:u.banco.idTipoCuenta??"",nombreTipoCuenta:u.banco.nombreTipoCuenta??"",numeroCuenta:u.banco.numeroCuenta??""}),F(j.map(c=>({id:String(c.idBanco),nombre:c.bancoNombre}))),m(C.map(c=>({id:String(c.idTipoCuenta),nombre:c.nombre})))}catch(v){p.error("Error al cargar datos de banco: "+v.message)}finally{l(!1)}})()},[a]);const S=async()=>{if(b)try{l(!0);const r={...b,identificacion:Z(b.identificacion),banco:n};(await Q(a,r)).success?p.success("Datos de banco actualizados."):p.error("Error al actualizar datos de banco.")}catch(r){p.error("Error al guardar: "+r.message)}finally{l(!1)}};return i?e.jsx("p",{children:"Cargando datos de banco..."}):e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Datos Bancarios"}),e.jsx(J,{onClick:S,disabled:i,className:"text-white",children:"Guardar datos"}),e.jsx(V,{children:e.jsxs(L,{className:"p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(Fe,{label:"Banco",options:$,value:n.idBanco,onChange:r=>x({...n,idBanco:r})}),e.jsx(Fe,{label:"Tipo de Cuenta",options:d,value:n.idTipoCuenta,onChange:r=>x({...n,idTipoCuenta:r})}),e.jsx(Fa,{label:"Número de Cuenta",value:n.numeroCuenta,onChange:r=>x({...n,numeroCuenta:r.target.value})})]})})]})}function Fa({label:a,value:i,onChange:l,type:b="text"}){return e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:a}),e.jsx(z,{placeholder:"---",type:b,value:i,onChange:l})]})}function Fe({label:a,options:i,value:l,onChange:b}){return e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:a}),e.jsxs(A,{value:String(l),onValueChange:b,children:[e.jsx(k,{className:"bg-white border border-gray-700",children:e.jsx(R,{placeholder:"Seleccione una opción"})}),e.jsx(I,{className:"bg-white",children:i.map(y=>e.jsx(N,{value:y.id,children:y.nombre},y.id))})]})]})}const ce=()=>{var i;return{"Content-Type":"application/json",Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("user")))==null?void 0:i.token}`}},se=async a=>{if(!a.ok){const i=await a.text();throw new Error(i||"Error en la solicitud")}return await a.json()},za=async a=>{const i=await fetch(`${T}/vista/beneficiario/filtrar?por=idSolicitudInversion&id=${a}`,{headers:ce()});return se(i)},Ba=async a=>{const i=await fetch(`${T}/beneficiario`,{method:"POST",headers:ce(),body:JSON.stringify(a)});return se(i)},Oa=async(a,i)=>{const l=await fetch(`${T}/beneficiario/${a}`,{method:"PUT",headers:ce(),body:JSON.stringify(i)});return se(l)},Ga=async a=>{const i=await fetch(`${T}/beneficiario/${a}`,{method:"DELETE",headers:ce()});return se(i)};function ui(){var c;const{id:a}=he(),{user:i}=Be(),[l,b]=t.useState([]),[y,n]=t.useState(!1),[x,$]=t.useState(!1),[F,d]=t.useState([]),[m,S]=t.useState({idSolicitudInversion:Number(a),nombre:"",idTipoDocumento:"",numeroDocumento:"",correoElectronico:"",telefono:"",direccion:"",porcentajeBeneficio:"",fechaCreacion:new Date().toISOString(),idUsuarioPropietario:i.idUsuario}),r=async()=>{try{const o=await za(a);b(o)}catch(o){console.error("Error al cargar beneficiarios:",o)}};t.useEffect(()=>{(async()=>{try{const h=await Oe();d(h)}catch(h){console.error("Error al cargar tipos de identificación:",h)}})(),r()},[]);const v=()=>{$(!1),S({idSolicitudInversion:Number(a),nombre:"",idTipoDocumento:"",numeroDocumento:"",correoElectronico:"",telefono:"",direccion:"",porcentajeBeneficio:"",fechaCreacion:new Date().toISOString(),idUsuarioPropietario:i.idUsuario}),n(!0)},u=o=>{$(!0),S({idBeneficiario:o.idBeneficiario,idSolicitudInversion:Number(a),nombre:o.nombre,idTipoDocumento:o.idTipoDocumento,numeroDocumento:o.numeroDocumento,correoElectronico:o.correoElectronico,telefono:o.telefono,direccion:o.direccion,porcentajeBeneficio:o.porcentajeBeneficio,fechaCreacion:o.fechaCreacion,idUsuarioPropietario:i.idUsuario}),n(!0)},j=async o=>{if(window.confirm(`¿Deseas eliminar a "${o.nombre}"?`))try{await Ga(o.idBeneficiario),p.success("Beneficiario eliminado"),r()}catch(h){console.error("Error al eliminar:",h),p.error("Error al eliminar beneficiario")}},C=[{key:"nombre",label:"Nombre"},{key:"idTipoDocumento",label:"Tipo Documento"},{key:"numeroDocumento",label:"Número Documento"},{key:"correoElectronico",label:"Correo"},{key:"telefono",label:"Teléfono"},{key:"direccion",label:"Dirección"},{key:"porcentajeBeneficio",label:"Porcentaje (%)"},{key:"fechaCreacion",label:"Fecha de Creación"}];return e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Beneficiarios"}),e.jsx(V,{children:e.jsx(L,{className:"p-6 space-y-4",children:e.jsx("div",{children:e.jsx(ge,{columns:C,data:l,mostrarEditar:!0,mostrarAgregarNuevo:!0,mostrarEliminar:!0,onAgregarNuevoClick:v,onEditarClick:u,onEliminarClick:j})})})}),e.jsx(fe,{open:y,onOpenChange:n,children:e.jsxs(xe,{children:[e.jsx(Ge,{children:e.jsx(Ve,{children:x?"Editar beneficiario":"Agregar beneficiario"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Y,{label:"Nombre",children:e.jsx(z,{value:m.nombre,onChange:o=>S({...m,nombre:o.target.value})})}),e.jsx(Y,{label:"Tipo Documento",children:e.jsxs(A,{value:(c=m.idTipoDocumento)==null?void 0:c.toString(),onValueChange:o=>S({...m,idTipoDocumento:Number(o)}),children:[e.jsx(k,{className:"bg-white border border-gray-300",children:e.jsx(R,{placeholder:"Seleccionar..."})}),e.jsx(I,{className:"bg-white",children:F.map(o=>e.jsx(N,{value:o.idTipoIdentificacion.toString(),children:o.tipo},o.idTipoIdentificacion))})]})}),e.jsx(Y,{label:"Número Documento",children:e.jsx(z,{value:m.numeroDocumento,onChange:o=>S({...m,numeroDocumento:o.target.value})})}),e.jsx(Y,{label:"Correo electrónico",children:e.jsx(z,{type:"email",value:m.correoElectronico,onChange:o=>S({...m,correoElectronico:o.target.value})})}),e.jsx(Y,{label:"Teléfono",children:e.jsx(z,{value:m.telefono,onChange:o=>S({...m,telefono:o.target.value})})}),e.jsx(Y,{label:"Dirección",children:e.jsx(z,{value:m.direccion,onChange:o=>S({...m,direccion:o.target.value})})}),e.jsx(Y,{label:"Porcentaje de beneficio",children:e.jsx(z,{type:"number",value:m.porcentajeBeneficio,onChange:o=>S({...m,porcentajeBeneficio:o.target.value})})})]}),e.jsx(pe,{className:"pt-4",children:e.jsx(J,{onClick:async()=>{const{nombre:o,idTipoDocumento:h,numeroDocumento:g,correoElectronico:w,telefono:U,direccion:f,porcentajeBeneficio:E}=m;if(!o.trim()||!h||!g.trim()||!w.trim()||!U.trim()||!f.trim()||!E){p.error("Todos los campos son obligatorios");return}try{x?(await Oa(m.idBeneficiario,m),p.success("Beneficiario actualizado")):(await Ba(m),p.success("Beneficiario creado")),r(),n(!1),$(!1),S({idSolicitudInversion:Number(a),nombre:"",telefono:"",porcentaje:"",idUsuarioPropietario:i.idUsuario})}catch(D){console.error("Error al guardar beneficiario:",D),p.error("No se pudo guardar el beneficiario")}},children:x?"Actualizar":"Crear"})})]})})]})}function Y({label:a,children:i}){return e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:a}),i]})}const Va=()=>{var i;return{"Content-Type":"application/json",Authorization:`Bearer ${(i=JSON.parse(localStorage.getItem("user")))==null?void 0:i.token}`}},La=async a=>{if(!a.ok){const i=await a.text();throw new Error(i||"Error en la solicitud")}return a.json()},Ja=async()=>{const a=await fetch(`${T}/ContinuarSolicitud`,{headers:Va()});return La(a)};function mi({id:a}){const[i,l]=t.useState(!0),[b,y]=t.useState(!1),[n,x]=t.useState(null),[$,F]=t.useState([]),[d,m]=t.useState({numeroContrato:"",idContinuarSolicitud:"",nombreContinuarSolicitud:"",motivoFinalizacion:"",observacionFinalizacion:"",confirmar:!1});t.useEffect(()=>{(async()=>{try{const C=(await K(a)).data[0];x(C),m({numeroContrato:C.finalizacion.numeroContrato??"",idContinuarSolicitud:C.finalizacion.idContinuarSolicitud??"",nombreContinuarSolicitud:C.finalizacion.nombreContinuarSolicitud??"",motivoFinalizacion:C.finalizacion.motivoFinalizacion??"",observacionFinalizacion:C.finalizacion.observacionFinalizacion??"",confirmar:C.finalizacion.confirmar??!1})}catch(j){p.error("Error al cargar finalización: "+j.message)}finally{l(!1)}})()},[a]),t.useEffect(()=>{(async()=>{try{const j=await Ja();F(Array.isArray(j)?j:[])}catch(j){p.error("Error al cargar catálogo: "+j.message)}})()},[]);const S=async()=>{if(n)try{l(!0);const u={...n,identificacion:Z(n.identificacion),finalizacion:d};(await Q(a,u)).success?p.success("Finalización actualizada."):p.error("Error al actualizar.")}catch(u){p.error("Error al guardar: "+u.message)}finally{l(!1)}},r=()=>{const u=`PROVISIONAL-${Math.floor(Math.random()*1e3)}`;m(j=>({...j,numeroContrato:u}))},v=async()=>{if(d.idContinuarSolicitud===1){y(!0);try{await na(a),p.success("Tareas generadas correctamente.")}catch(u){p.error("Error al generar tareas: "+u.message)}finally{y(!1)}}m({...d,confirmar:!0})};return i?e.jsx(Ae,{visible:!0,message:"Cargando finalización..."}):e.jsxs("div",{className:"space-y-6 p-6 relative",children:[e.jsx(Ae,{visible:b,message:"Generando tareas..."}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(J,{onClick:S,className:"bg-primary text-white hover:bg-primary/80 flex items-center gap-2",children:[e.jsx(Xe,{className:"w-4 h-4"})," Guardar"]})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Finalización"}),e.jsx(V,{children:e.jsxs(L,{className:"p-6 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(me,{label:"Número de contrato",value:d.numeroContrato,onChange:u=>m({...d,numeroContrato:u.target.value}),disabled:d.confirmar}),e.jsx(J,{onClick:r,className:"h-10",variant:"muted",disabled:!!d.numeroContrato.trim()||d.confirmar,children:"Generar contrato"})]}),e.jsx(Ma,{label:"Acción",children:e.jsxs(A,{disabled:d.confirmar,value:String(d.idContinuarSolicitud),onValueChange:u=>{const j=parseInt(u,10),C=$.find(c=>c.idContinuarSolicitud===j);m({...d,idContinuarSolicitud:j,nombreContinuarSolicitud:(C==null?void 0:C.nombre)??""})},children:[e.jsx(k,{className:"text-sm border border-black",children:e.jsx(R,{placeholder:"Seleccione una acción"})}),e.jsx(I,{className:"bg-white",children:$.map(u=>e.jsx(N,{value:String(u.idContinuarSolicitud),children:u.nombre},u.idContinuarSolicitud))})]})}),d.idContinuarSolicitud===2&&e.jsxs(e.Fragment,{children:[e.jsx(me,{label:"Motivo de finalización",value:d.motivoFinalizacion,onChange:u=>m({...d,motivoFinalizacion:u.target.value})}),e.jsx(me,{label:"Observación de finalización",value:d.observacionFinalizacion,onChange:u=>m({...d,observacionFinalizacion:u.target.value})})]}),(d.idContinuarSolicitud===1||d.idContinuarSolicitud===2)&&e.jsx(qa,{label:"Confirmar",checked:d.confirmar,idContinuar:d.idContinuarSolicitud,onConfirm:v,className:"border border-gray-300 p-4 rounded-md"})]})})]})}function me({label:a,value:i,onChange:l,type:b="text",disabled:y}){return e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:a}),e.jsx(z,{placeholder:"---",type:b,value:i,onChange:l,disabled:y})]})}function qa({label:a,checked:i,onConfirm:l,idContinuar:b}){const[y,n]=t.useState(!1),x=()=>{n(!1),l()};return i?e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(X,{checked:!0,disabled:!0,className:"bg-primary border-primary"}),e.jsx(P,{className:"text-sm font-medium text-gray-700",children:a})]}):e.jsxs(ta,{open:y,onOpenChange:n,children:[e.jsx(ca,{asChild:!0,children:e.jsxs("div",{className:"flex items-center gap-4 cursor-pointer",children:[e.jsx(X,{checked:!1,onCheckedChange:()=>n(!0)}),e.jsx(P,{className:"text-sm font-medium text-gray-700",children:a})]})}),e.jsxs(sa,{className:"bg-white text-black border border-gray-300",children:[e.jsx(la,{children:e.jsx(da,{children:"¿Estás seguro de terminar la solicitud?"})}),e.jsxs(ua,{children:[e.jsx(ma,{children:"Cancelar"}),e.jsxs(ha,{onClick:x,children:["Sí, ",b===1?"crear tareas":"finalizar"]})]})]})]})}function Ma({label:a,children:i}){return e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(P,{className:"text-sm font-medium text-gray-700",children:a}),i]})}export{si as A,di as B,li as C,ci as D,mi as F,ni as I,ti as P,ui as a};
