import{u as j,c as w,r as t,j as o,G as E,C as k,d as N,e as v,a as P,t as l}from"./index-ABbIRX4x.js";import{T as D}from"./TablaCustom2-DS7_i3Ng.js";import{D as A,a as I,b as T,c as $,d as M}from"./jspdf.plugin.autotable-CZR7NrjE.js";import O from"./ProspectoForm-DX2A1h5T.js";import{g as R,d as S}from"./ProspectoService-DqbVOVKq.js";import"./select-C75wXMdb.js";import"./index-CFqNEq9z.js";import"./ProductoInteresService-DsF71vH2.js";import"./OrigenClienteService-DdBWUzxM.js";import"./TipoIdentificacionService-BJmrDHaB.js";function J(){const u=j(),{user:c,roles:s}=w(),[d,x]=t.useState([]),[g,p]=t.useState(!0),[f,i]=t.useState(!1),m=t.useRef(!1);let a;s.includes("Externo")?a="Crea tu perfil de prospecto":s.includes("Asesor Comercial")?a="Mis Prospectos":a="Todos los prospectos";const n=async()=>{p(!0);try{const e=await R();let r=e;(s.includes("Asesor Comercial")||s.includes("Externo"))&&(r=e.filter(C=>C.idUsuarioPropietario===c.id)),s.includes("Externo")&&r.length===0&&!m.current&&(l.info("Debes agregarte como prospecto para crear una solicitud de inversión."),m.current=!0),x(r)}catch(e){l.error("Error al cargar prospectos: "+(e.message??e))}finally{p(!1)}};t.useEffect(()=>{n()},[s,c]);const h=e=>{u(`/prospectos/editar/${e.idProspecto}`)},b=async e=>{if(window.confirm("¿Eliminar este prospecto?"))try{await S(e.idProspecto),l.success("Prospecto eliminado."),n()}catch(r){l.error("Error al eliminar prospecto: "+(r.message??r))}},y=[{key:"idProspecto",label:"",render:e=>o.jsxs("div",{className:"flex items-center justify-center group relative text-gray-400",children:[o.jsx("svg",{className:"w-5 h-5 md:w-6 md:h-6",fill:"none",stroke:"currentColor",strokeWidth:"1.8",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.121 17.804A9.003 9.003 0 0112 15c2.486 0 4.735.996 6.364 2.634M15 11a3 3 0 11-6 0 3 3 0 016 0z"})}),o.jsxs("span",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-1 text-xs text-white bg-zinc-800 px-2 py-0.5 rounded shadow opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-50 whitespace-nowrap",children:["ID: ",e]})]})},{key:"nombreCompleto",label:"Nombre completo",render:(e,r)=>o.jsx("span",{className:"whitespace-nowrap font-semibold",children:`${r.nombres??""} ${r.apellidoPaterno??""} ${r.apellidoMaterno??""}`})},{key:"esCliente",label:"¿Es Cliente?",render:e=>o.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${e?"bg-green-100 text-green-700":"bg-gray-200 text-gray-600"}`,children:e?"Sí":"No"})},{key:"tipoIdentificacion",label:"Tipo ID"},{key:"telefonoCelular",label:"Núm. Celular"},{key:"correoElectronico",label:"Correo"},{key:"nombreOrigen",label:"Origen"},{key:"productoInteres",label:"Producto de Interés"},{key:"agencia",label:"Agencia"},{key:"estado",label:"Estado",render:e=>o.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${e?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:e?"Activo":"Inactivo"})}];return o.jsxs("div",{className:"p-4 sm:p-6 md:p-10 max-w-7xl mx-auto",children:[o.jsx(E,{visible:g,message:"Cargando prospectos..."}),o.jsxs(k,{className:"w-full border border-muted rounded-2xl shadow-[0_4px_10px_rgba(0,0,0,0.10)]",children:[o.jsx(N,{children:o.jsx(v,{className:"text-3xl font-bold text-gray-900 flex items-center",children:a})}),o.jsx(P,{className:"p-6 overflow-x-auto",children:o.jsx(D,{columns:y,data:[...d].sort((e,r)=>new Date(r.fechaCreacion||r.fechaRegistro||0)-new Date(e.fechaCreacion||e.fechaRegistro||0)),mostrarEditar:!0,mostrarAgregarNuevo:!(s.includes("Externo")&&d.length>=1),mostrarEliminar:!0,onAgregarNuevoClick:()=>i(!0),onEditarClick:h,onEliminarClick:b})})]}),o.jsx(A,{open:f,onOpenChange:i,children:o.jsxs(I,{className:"min-w-[420px] max-w-xl",children:[o.jsxs(T,{children:[o.jsx($,{children:"Agregar Prospecto"}),o.jsx(M,{children:"Completa la información del nuevo prospecto"})]}),o.jsx(O,{onClose:()=>i(!1),onSaved:n})]})})]})}export{J as default};
