import{f as L,r as x,j as a,C as I,a as R,L as b,i as N,S as T,B as M,g as V,t as n,I as z}from"./index-CG6H-kfp.js";import{S as A}from"./switch-f3LOaz4k.js";import{g as F}from"./TipoIdentificacionService-DqUkVc03.js";import{v as k,b as O,c as U}from"./SolicitudService-CKfwnCvg.js";import{S as B,a as J,b as G,c as $,d as H}from"./select-B3dX9JJ0.js";import"./index-DMmKv1VD.js";function _({onClose:s,idProspecto:i}){const{user:l}=L(),[m,f]=x.useState([]),[e,c]=x.useState({tipoSolicitud:"",tipoCliente:"",tipoDocumento:"",numeroDocumento:"",nombres:"",apellidoPaterno:"",apellidoMaterno:"",validar:!1,equifax:"",obsEquifax:"",listasControl:"",obsListasControl:"",continuar:"Continuar con la solicitud"}),[g,p]=x.useState(!1);x.useEffect(()=>{F().then(f)},[]);const r=(o,d)=>{c(t=>({...t,[o]:d}))},C=()=>e.tipoSolicitud&&e.tipoCliente&&e.tipoDocumento&&e.numeroDocumento.trim()&&e.nombres.trim()&&e.apellidoPaterno.trim()&&e.apellidoMaterno.trim(),S=async()=>{var o,d;if(!C()){n.error("Por favor llena todos los campos antes de validar.");return}p(!0);try{const t=await k(e.numeroDocumento),v=t.success&&t.resultado.resultado?"Paso":"Rechazado",q=((o=t.resultado)==null?void 0:o.observacion)||"Sin observación",j=await O({identificacion:e.numeroDocumento,primerNombre:e.nombres.split(" ")[0]||"",segundoNombre:e.nombres.split(" ")[1]||"",primerApellido:e.apellidoPaterno,segundoApellido:e.apellidoMaterno}),w=j.success&&!j.resultado.coincidencia?"Paso":"Rechazado",E=((d=j.resultado)==null?void 0:d.mensaje)||"Sin observación";c(P=>({...P,equifax:v,obsEquifax:q,listasControl:w,obsListasControl:E,validar:!0})),n.success("Validación completada")}catch(t){n.error("Error al validar: "+t.message)}finally{p(!1)}},D=async()=>{if(!C()){n.error("Completa todos los campos antes de guardar.");return}const o=(t,v)=>v.indexOf(t)+1,d={idUsuarioPropietario:l.id,idProspecto:Number(i),identificacion:{tipoSolicitud:o(e.tipoSolicitud,["Nueva","Renovación","Incremento"]),tipoCliente:o(e.tipoCliente,["Natural","Jurídico"]),tipoDocumento:o(e.tipoDocumento,["Cédula","RUC","Pasaporte"]),numeroDocumento:e.numeroDocumento,nombres:e.nombres,apellidoPaterno:e.apellidoPaterno,apellidoMaterno:e.apellidoMaterno,validar:e.validar,equifax:e.equifax,obsEquifax:e.obsEquifax,listasControl:e.listasControl,obsListasControl:e.obsListasControl,continuar:e.continuar==="Continuar con la solicitud"?1:0}};p(!0);try{(await U(d)).success?(n.success("Solicitud creada correctamente."),s==null||s()):n.error("Error al guardar solicitud.")}catch(t){n.error("Error: "+t.message)}finally{p(!1)}};return a.jsx("div",{className:"space-y-6 p-4 max-h-[80vh] overflow-y-auto scrollbar-light",children:a.jsx(I,{className:"shadow-md rounded-2xl bg-white border border-gray-200",children:a.jsxs(R,{className:"p-6 space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsx(h,{label:"Tipo de solicitud",value:e.tipoSolicitud,onChange:o=>r("tipoSolicitud",o),options:["Nueva","Renovación","Incremento"]}),a.jsx(h,{label:"Tipo de cliente",value:e.tipoCliente,onChange:o=>r("tipoCliente",o),options:["Natural","Jurídico"]}),a.jsx(h,{label:"Tipo de documento",value:e.tipoDocumento,onChange:o=>r("tipoDocumento",o),options:["Cédula","RUC","Pasaporte"]}),a.jsx(u,{label:"Número de documento",value:e.numeroDocumento,onChange:o=>r("numeroDocumento",o.target.value)}),a.jsx(u,{label:"Nombres",value:e.nombres,onChange:o=>r("nombres",o.target.value)}),a.jsx(u,{label:"Apellido paterno",value:e.apellidoPaterno,onChange:o=>r("apellidoPaterno",o.target.value)}),a.jsx(u,{label:"Apellido materno",value:e.apellidoMaterno,onChange:o=>r("apellidoMaterno",o.target.value)}),a.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[a.jsx(A,{checked:e.validar,onCheckedChange:o=>{if(!o)return r("validar",!1);S()}}),a.jsx(b,{className:"text-sm font-medium text-gray-700",children:"Validar"}),g&&a.jsxs("span",{className:"text-sm text-muted-foreground flex items-center",children:[a.jsx(N,{className:"w-4 h-4 animate-spin mr-1"})," Validando..."]})]})]}),e.validar&&(e.equifax||e.listasControl)&&a.jsxs(a.Fragment,{children:[a.jsx(T,{className:"my-6"}),a.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Resultado de Validación"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsx(u,{label:"Identidad (Equifax)",value:e.equifax,disabled:!0}),a.jsx(y,{label:"Observación Equifax",value:e.obsEquifax,disabled:!0}),a.jsx(u,{label:"Listas de Control (LDS)",value:e.listasControl,disabled:!0}),a.jsx(y,{label:"Observación LDS",value:e.obsListasControl,disabled:!0}),a.jsx(h,{label:"Continuar",value:e.continuar,onChange:o=>r("continuar",o),options:["Continuar con la solicitud","Rechazar solicitud"],full:!0,disabled:e.equifax==="Rechazado"||e.listasControl==="Rechazado"})]})]}),a.jsx("div",{className:"flex justify-end",children:a.jsxs(M,{onClick:D,disabled:g,className:"bg-primary text-white hover:bg-primary/90 px-6 py-2 rounded-lg",children:[g?a.jsx(N,{className:"w-4 h-4 animate-spin mr-2"}):a.jsx(V,{className:"w-4 h-4 mr-2"}),"Guardar"]})})]})})})}function u({label:s,value:i,onChange:l,disabled:m}){return a.jsxs("div",{className:"space-y-1",children:[a.jsx(b,{className:"text-sm text-gray-700 font-medium",children:s}),a.jsx(z,{value:i,onChange:l,disabled:m,className:"text-sm border-gray-300",placeholder:s})]})}function h({label:s,value:i,onChange:l,options:m=[],full:f=!1,disabled:e}){return a.jsxs("div",{className:`space-y-1 ${f?"md:col-span-2":""}`,children:[a.jsx(b,{className:"text-sm text-gray-700 font-medium",children:s}),a.jsxs(B,{value:i,onValueChange:l,disabled:e,children:[a.jsx(J,{className:"text-sm border-gray-300 bg-white",children:a.jsx(G,{placeholder:s})}),a.jsx($,{className:"bg-white border border-gray-200",children:m.map(c=>a.jsx(H,{value:c,children:c},c))})]})]})}function y({label:s,value:i,disabled:l}){return a.jsxs("div",{className:"space-y-1",children:[a.jsx(b,{className:"text-sm text-gray-700 font-medium",children:s}),a.jsx("textarea",{rows:3,value:i,disabled:l,placeholder:s,className:"w-full text-sm rounded-md border border-gray-300 px-3 py-2 resize-none"})]})}export{_ as default};
