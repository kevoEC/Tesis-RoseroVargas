import{f as S,u as F,c as k,r as n,j as e,G as I,B as c,I as N,t as m}from"./index-ABbIRX4x.js";import{a as A,u as L}from"./ProductoService-HhWDSlJO.js";import{C as $,g as T,d as O}from"./ConfiguracionesProductoForm-C1espO3S.js";import{T as z}from"./TablaCustom2-DS7_i3Ng.js";import{D as U,a as B,b as G,c as R,d as V}from"./jspdf.plugin.autotable-CZR7NrjE.js";import{T as H}from"./textarea-B4rIvIUE.js";const _=[{idFormaPago:1,formaPagoNombre:"No Aplica"},{idFormaPago:2,formaPagoNombre:"Al finalizar"},{idFormaPago:3,formaPagoNombre:"Según su periodicidad"}],q={0:"Al finalizar",1:"Mensual",2:"Bimensual",3:"Trimestral",6:"Semestral"};function ee(){var j;const{id:r}=S(),u=F(),{user:J}=k(),[a,C]=n.useState(null),[v,y]=n.useState([]),[w,b]=n.useState(!0),[E,t]=n.useState(!1),[p,h]=n.useState(null),[g,f]=n.useState(!1),[o,l]=n.useState({}),x=async()=>{b(!0);try{const i=await A(r);C(i),l({...i,descripcion:i.descripcion||"",penalidad:i.penalidad??"",montoMinimoIncremento:i.montoMinimoIncremento??""});const s=await T(r);y(Array.isArray(s)?s:[])}catch(i){m.error("Error al cargar datos: "+(i.message??i))}finally{b(!1)}};n.useEffect(()=>{x()},[r]);const P=async i=>{if(window.confirm("¿Eliminar esta configuración?"))try{await O(i.idConfiguraciones),m.success("Configuración eliminada."),x()}catch(s){m.error("Error al eliminar: "+(s.message??s))}},M=async()=>{try{await L(a.idProducto,{...a,descripcion:o.descripcion,penalidad:Number(o.penalidad),montoMinimoIncremento:Number(o.montoMinimoIncremento),idUsuarioModificacion:a.idUsuarioCreacion,fechaModificacion:new Date().toISOString()}),m.success("Producto actualizado correctamente"),f(!1),x()}catch(i){m.error("Error al actualizar: "+(i.message??i))}},D=[{key:"montoMinimo",label:"Monto Mínimo",render:i=>`$${Number(i).toLocaleString("es-EC",{minimumFractionDigits:2})}`},{key:"montoMaximo",label:"Monto Máximo",render:i=>`$${Number(i).toLocaleString("es-EC",{minimumFractionDigits:2})}`},{key:"plazo",label:"Plazo (meses)"},{key:"taza",label:"Tasa (%)",render:i=>`${Number(i).toFixed(2)}%`},{key:"costeOperativoEEUU",label:"Costo EEUU",render:i=>`$${Number(i).toLocaleString("es-EC",{minimumFractionDigits:2})}`},{key:"origenNombre",label:"Origen"},{key:"tipoTasaNombre",label:"Tipo de tasa"},{key:"fechaCreacion",label:"Fecha Creación",render:i=>i?new Date(i).toLocaleDateString():""},{key:"usuarioCreacion",label:"Creado por"}];return w?e.jsx(I,{visible:!0,message:"Cargando producto..."}):e.jsxs("div",{className:"py-8 px-0 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2 border-b border-gray-200 pb-3",children:[e.jsx(c,{variant:"outline",onClick:()=>u("/catalogo/producto/vista"),className:"px-5 py-2",children:"← Volver"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:(a==null?void 0:a.productoNombre)||"-"}),e.jsxs("span",{className:"text-base text-gray-500 ml-3 font-semibold",children:["ID: ",a==null?void 0:a.idProducto]}),e.jsxs("div",{className:"ml-auto flex flex-col items-end gap-1",children:[e.jsxs("span",{className:"text-gray-700 text-base font-medium",children:[e.jsx("b",{children:"Creado por:"})," ",a==null?void 0:a.usuarioCreacionNombre]}),e.jsxs("span",{className:"text-gray-700 text-base font-medium",children:[e.jsx("b",{children:"Fecha creación:"})," ",a!=null&&a.fechaCreacion?new Date(a.fechaCreacion).toLocaleString("es-EC"):"-"]})]})]}),e.jsx("div",{className:"w-full mt-3 mb-8",children:e.jsxs("div",{className:"grid md:grid-cols-2 grid-cols-1 gap-x-12 gap-y-2 p-5 bg-white",style:{border:"1.5px solid #bbb",borderRadius:12},children:[e.jsx(d,{label:"Nombre comercial",value:a==null?void 0:a.nombreComercial}),e.jsx(d,{label:"Código",value:a==null?void 0:a.productoCodigo}),e.jsx(d,{label:"Iniciales",value:a==null?void 0:a.iniciales}),e.jsx(d,{label:"Periodicidad",value:q[a==null?void 0:a.periocidad]}),e.jsx(d,{label:"Forma de pago",value:((j=_.find(i=>i.idFormaPago===(a==null?void 0:a.idFormaPago)))==null?void 0:j.formaPagoNombre)||"-"}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx("span",{className:"text-gray-500 w-44",children:"Monto mínimo incremento:"}),g?e.jsx(N,{type:"number",step:"0.01",className:"w-32",value:o.montoMinimoIncremento,onChange:i=>l(s=>({...s,montoMinimoIncremento:i.target.value}))}):e.jsx("span",{className:"font-semibold text-gray-900",children:a!=null&&a.montoMinimoIncremento?`$${Number(a.montoMinimoIncremento).toLocaleString("es-EC",{minimumFractionDigits:2})}`:"-"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx("span",{className:"text-gray-500 w-44",children:"Penalidad (%):"}),g?e.jsx(N,{type:"number",step:"0.01",className:"w-32",value:o.penalidad,onChange:i=>l(s=>({...s,penalidad:i.target.value}))}):e.jsx("span",{className:"font-semibold text-gray-900",children:(a==null?void 0:a.penalidad)!==void 0?`${a.penalidad}%`:"-"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm col-span-2",children:[e.jsx("span",{className:"text-gray-500 w-44",children:"Descripción:"}),g?e.jsx(H,{value:o.descripcion,rows:2,className:"w-full",maxLength:255,onChange:i=>l(s=>({...s,descripcion:i.target.value}))}):e.jsx("span",{className:"font-semibold text-gray-900 text-justify",children:a==null?void 0:a.descripcion})]}),e.jsx("div",{className:"col-span-2 flex justify-end gap-4 mt-3",children:g?e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"outline",onClick:()=>{l({...a,descripcion:a.descripcion||"",penalidad:a.penalidad??"",montoMinimoIncremento:a.montoMinimoIncremento??""}),f(!1)},children:"Cancelar"}),e.jsx(c,{className:"bg-violet-600 hover:bg-violet-700 text-white px-7",onClick:M,children:"Guardar cambios"})]}):e.jsx(c,{className:"bg-violet-600 hover:bg-violet-700 text-white px-7",onClick:()=>f(!0),children:"Editar producto"})})]})}),e.jsxs("section",{className:"w-full bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Configuraciones de producto"}),e.jsx(c,{className:"bg-violet-600 hover:bg-violet-700 text-white",onClick:()=>{h(null),t(!0)},children:"+ Agregar configuración"})]}),e.jsx(z,{columns:D,data:v,mostrarEditar:!0,mostrarEliminar:!0,mostrarAgregarNuevo:!1,onEditarClick:i=>{h(i),t(!0)},onEliminarClick:P})]}),e.jsx(U,{open:E,onOpenChange:t,children:e.jsxs(B,{className:"min-w-[420px] max-w-xl",children:[e.jsxs(G,{children:[e.jsx(R,{children:p?"Editar configuración":"Agregar configuración"}),e.jsx(V,{children:"Completa los datos de la configuración para este producto."})]}),e.jsx($,{idProducto:a==null?void 0:a.idProducto,initialData:p,onClose:()=>t(!1),onSaved:()=>{t(!1),x()}})]})})]})}function d({label:r,value:u}){return e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("span",{className:"text-gray-500 w-44",children:[r,":"]}),e.jsx("span",{className:"font-semibold text-gray-900",children:u??"-"})]})}export{ee as default};
