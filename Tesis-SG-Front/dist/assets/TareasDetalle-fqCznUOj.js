import{A as J,f as W,u as Y,r as n,j as e,G as q,h as K,B as N,n as Q,S as X,t as w,E as O,x as Z}from"./index-ABbIRX4x.js";import{a as ee,u as ae}from"./TareaService-8EzhbblL.js";import{T as se}from"./TablaCustom2-DS7_i3Ng.js";import{A as te}from"./AdjuntoForm-DZV0TiXW.js";import{D as re,a as oe,b as le,c as ne,d as ie}from"./jspdf.plugin.autotable-CZR7NrjE.js";import{A as ce,a as de,b as me,c as xe,d as ue,e as he,f as pe}from"./alert-dialog-BbB2nhGe.js";const ge=async l=>{if(!l.ok){const o=await l.text();throw new Error(o||"Error en la solicitud")}return await l.json()},be=()=>{var o;return{"Content-Type":"application/json",Authorization:`Bearer ${(o=JSON.parse(localStorage.getItem("user")))==null?void 0:o.token}`}},fe=async l=>{const o=await fetch(`${J}/tarea/${l}`,{headers:be()}),t=await ge(o);return Array.isArray(t)?t[0]||null:t};function De(){const{id:l}=W(),o=Y(),[t,i]=n.useState(null),[x,d]=n.useState(!0),[g,b]=n.useState([]),[f,j]=n.useState(2),[C,T]=n.useState(""),[I,u]=n.useState(!1),[A,F]=n.useState(2),[P,D]=n.useState(null),[L,h]=n.useState(!1),[S,z]=n.useState(!1),[R,y]=n.useState({});n.useEffect(()=>{t&&y(t.camposTipo||{})},[t]);const c=(a,s)=>{y(m=>({...m,[a]:s}))},r=t&&t.idResultado===1,M={1:23,2:23,3:14,4:7,5:8},v=async()=>{d(!0);try{const a=await fe(l);if(a.success){i(a.data),j(a.data.idResultado),T(a.data.observacion??""),y(a.data.camposTipo||{});const s=a.data.idSolicitudInversion,m=M[a.data.idTipoTarea],V=(await ee(s,m)).filter(U=>U.idTarea===a.data.idTarea);b(V)}}catch(a){w.error("Error al cargar la tarea: "+a.message)}finally{d(!1)}};n.useEffect(()=>{v()},[l]);const B=async()=>{var a,s;z(!0);try{const m={idResultado:f,observacion:C,camposTipo:R};await ae(t.idTarea,m),w.success("Tarea actualizada correctamente"),v()}catch(m){w.error("Error al guardar tarea: "+(((s=(a=m.response)==null?void 0:a.data)==null?void 0:s.message)||m.message))}finally{z(!1)}},G=a=>{a===1||a===3?(F(a),u(!0)):j(a)},H=async()=>{j(A),u(!1)},_=a=>{switch(a){case 1:return e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-green-100 text-green-700 font-semibold whitespace-nowrap",children:"Aprobado"});case 3:return e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-red-100 text-red-700 font-semibold whitespace-nowrap",children:"Rechazado"});default:return e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-yellow-100 text-yellow-800 font-semibold whitespace-nowrap",children:"Pendiente"})}},$=()=>{const a=R||{};switch(t.idTipoTarea){case 1:return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(p,{label:"Reemplazar contrato",checked:!!a.ReemplazarContrato,onChange:s=>c("ReemplazarContrato",s),disabled:r}),e.jsx(p,{label:"Reemplazar anexo",checked:!!a.ReemplazarAnexo,onChange:s=>c("ReemplazarAnexo",s),disabled:r})]});case 2:return e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(p,{label:"Reemplazar contrato adendum",checked:!!a.ReemplazarContratoAdendum,onChange:s=>c("ReemplazarContratoAdendum",s),disabled:r})});case 3:return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(p,{label:"Firmado por gerencia",checked:!!a.FirmadoGerencia,onChange:s=>c("FirmadoGerencia",s),disabled:r}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-800",children:"Modo de firma"}),e.jsxs("select",{value:a.IdTipoFirma??"",onChange:s=>c("IdTipoFirma",Number(s.target.value)),className:"w-full border border-gray-300 rounded-lg p-2 text-sm mt-1",disabled:r,children:[e.jsx("option",{value:1,children:"Física"}),e.jsx("option",{value:2,children:"Digital"})]})]})]});case 4:return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-800",children:"Resumen"}),e.jsx("textarea",{value:a.DatosTarea||"",onChange:s=>c("DatosTarea",s.target.value),className:"w-full border border-gray-300 rounded-lg p-3 text-sm",rows:4,disabled:r})]});case 5:return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(E,{label:"Fecha Operación",type:"datetime-local",value:a.FechaOperacion?a.FechaOperacion:"",onChange:s=>c("FechaOperacion",s.target.value),disabled:r,placeholder:"Seleccione fecha y hora"}),e.jsx(E,{label:"Cuenta Abono",value:a.CuentaAbono||"",onChange:s=>c("CuentaAbono",s.target.value),disabled:r,placeholder:"Ej: 12345678"}),e.jsx(je,{label:"N° Comprobante Abono",value:a.NumeroComprobanteAbono||"",onChange:s=>c("NumeroComprobanteAbono",s.target.value),disabled:r,placeholder:"********"})]});default:return null}},k=[{key:"idDocumento",label:"",render:a=>e.jsxs("div",{className:"flex items-center justify-center group relative text-gray-500",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",strokeWidth:"1.5",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6M5 4v16h14V4H5zm2 2h10v12H7V6z"})}),e.jsxs("span",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-1 text-xs text-white bg-zinc-800 px-2 py-0.5 rounded shadow opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-50",children:["ID: ",a]})]})},{key:"tipoDocumentoNombre",label:"Tipo de Documento"},{key:"motivoNombre",label:"Motivo"}];return r&&k.push({key:"ver",label:"Ver",render:(a,s)=>e.jsx(N,{type:"button",size:"icon",variant:"ghost",className:"text-primary hover:bg-violet-100",onClick:()=>{D(s.idDocumento),h(!0)},title:"Ver",children:e.jsx(O,{size:18})})}),x||!t?e.jsx(q,{visible:!0,message:"Cargando tarea..."}):e.jsxs("div",{className:"relative",children:[r&&e.jsxs("div",{className:"w-full flex items-center px-6 py-2 bg-gray-50 border-b border-gray-300 shadow-sm mb-2 z-50 rounded-t-xl",style:{position:"sticky",top:0},children:[e.jsx(K,{className:"text-gray-700 w-5 h-5 mr-2"}),e.jsxs("span",{className:"font-semibold text-gray-700 text-sm",children:["Solo lectura: estado de esta tarea: ",e.jsx("span",{className:"text-violet-700",children:"Aprobada"})]})]}),e.jsxs("div",{className:"p-6 md:p-10 max-w-6xl mx-auto bg-white",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-1",children:[e.jsxs(N,{variant:"outline",onClick:()=>o("/tareas/vista"),className:"px-4 py-2",children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"Volver al listado"]}),e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 flex items-center gap-3 flex-wrap",children:[t.nombreTipoTarea," - Nueva - ",t.tareaNombre,e.jsx("span",{className:"ml-2",children:_(f)})]})]}),e.jsxs("div",{className:"flex flex-wrap text-xs text-gray-700 mb-2 gap-8",children:[e.jsxs("span",{children:[e.jsx("b",{children:"Tipo:"})," ",t.nombreTipoTarea]}),e.jsxs("span",{children:[e.jsx("b",{children:"Creado:"})," ",t.fechaCreacion?new Date(t.fechaCreacion).toLocaleString("es-EC"):"-"]}),e.jsxs("span",{children:[e.jsx("b",{children:"Owner:"})," ",t.nombreUsuarioPropietario||"-"]})]}),e.jsx("hr",{className:"mb-4"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("section",{className:"border rounded-xl p-6 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Descripción"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded-lg p-3 text-sm text-gray-900 resize-y",rows:5,value:t.descripcion||"",disabled:!0})]}),e.jsxs("section",{className:"border rounded-xl p-6 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Configuración de tarea"}),$()]})]}),e.jsx("div",{className:"flex flex-col gap-6",children:e.jsxs("section",{className:"border rounded-xl p-6 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Resultado"}),e.jsxs("select",{value:f,onChange:a=>G(Number(a.target.value)),className:"w-full border border-gray-300 rounded-lg p-3 text-sm",disabled:r,children:[e.jsx("option",{value:2,children:"Pendiente"}),e.jsx("option",{value:1,children:"Aprobado"}),e.jsx("option",{value:3,children:"Rechazado"})]}),e.jsx("label",{className:"block text-sm font-medium text-gray-800 mt-5 mb-1",children:"Observación"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded-lg p-3 text-sm text-gray-900 resize-y",rows:3,value:C,onChange:a=>T(a.target.value),disabled:r}),!r&&e.jsxs(N,{className:"bg-violet-600 hover:bg-violet-700 text-white w-full mt-4",onClick:B,disabled:S,type:"button",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),S?"Guardando...":"Actualizar tarea"]})]})})]}),e.jsxs("section",{className:"border rounded-xl p-6 shadow-sm mt-8 col-span-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Documentos Adjuntos"}),e.jsx(se,{columns:k,data:g,mostrarEditar:!r,mostrarAgregarNuevo:!1,mostrarEliminar:!1,onEditarClick:a=>{D(a.idDocumento),h(!0)}})]}),e.jsx(re,{open:L,onOpenChange:h,children:e.jsxs(oe,{children:[e.jsxs(le,{children:[e.jsx(ne,{children:"Adjunto"}),e.jsx(ie,{children:r?"Visualización de archivo adjunto":"Editar archivo"})]}),e.jsx(te,{documentoId:P,readOnly:r,onClose:()=>{h(!1),v()}})]})}),e.jsx(ce,{open:I,onOpenChange:u,children:e.jsxs(de,{className:"bg-white text-gray-900 border border-gray-300",children:[e.jsx(me,{children:e.jsxs(xe,{children:["¿Estás seguro de marcar esta tarea como ",A===1?"Aprobada":"Rechazada","?"]})}),e.jsxs(ue,{children:[e.jsx(he,{onClick:()=>u(!1),children:"Cancelar"}),e.jsx(pe,{onClick:H,children:"Sí, confirmar"})]})]})})]})]})}function p({label:l,checked:o,onChange:t=()=>{},disabled:i}){return e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium",children:l}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:x=>t(x.target.checked),className:"sr-only peer",disabled:i}),e.jsx("div",{className:`w-11 h-6 rounded-full transition-all ${i?"bg-gray-200":o?"bg-primary":"bg-gray-300"}`}),e.jsx("div",{className:`absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition-transform ${o?"translate-x-5":""}`})]})]})}function E({label:l,value:o,onChange:t,disabled:i,type:x="text",placeholder:d=""}){return e.jsxs("div",{className:"space-y-1.5 mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-800",children:l}),e.jsx("input",{type:x,value:o||"",onChange:t,disabled:i,placeholder:d,className:"w-full border border-gray-300 rounded-lg p-2 text-sm"})]})}function je({label:l,value:o,onChange:t,disabled:i,placeholder:x}){const[d,g]=n.useState(!1);return e.jsxs("div",{className:"space-y-1.5 mb-2 relative",children:[e.jsx("label",{className:"text-sm font-medium text-gray-800",children:l}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:d?"text":"password",value:o||"",onChange:t,disabled:i,placeholder:x,className:"w-full border border-gray-300 rounded-lg p-2 text-sm pr-10"}),e.jsx("button",{type:"button",tabIndex:-1,className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-700",onClick:()=>g(b=>!b),disabled:i,"aria-label":d?"Ocultar":"Mostrar",style:{outline:"none"},children:d?e.jsx(Z,{size:18}):e.jsx(O,{size:18})})]})]})}export{De as default};
