import{A as L,r as t,j as a,G as R,B as O,a1 as z,C as b,c as B,d as G,a as H,t as n,L as y}from"./index-CG6H-kfp.js";import{A as P,g as _,d as V,a as $}from"./AdjuntoForm-idwOlVfp.js";import{e as U,u as J}from"./SolicitudService-CKfwnCvg.js";import{T as W}from"./TablaCustom2-CwS24NS9.js";import{D as K,a as Q,b as X,c as Y,d as Z}from"./dialog-2_FlWSQy.js";import{A as oo,a as ao,b as eo,c as ro,d as so,e as to,f as lo}from"./alert-dialog-Bczf_PEy.js";import{S as co,a as no,b as io,c as uo,d as mo}from"./select-B3dX9JJ0.js";import{S as go}from"./switch-f3LOaz4k.js";const ho=o=>({tipoSolicitud:(o==null?void 0:o.idTipoSolicitud)??(o==null?void 0:o.tipoSolicitud)??null,tipoCliente:(o==null?void 0:o.idTipoCliente)??(o==null?void 0:o.tipoCliente)??null,tipoDocumento:(o==null?void 0:o.idTipoDocumento)??(o==null?void 0:o.tipoDocumento)??null,numeroDocumento:(o==null?void 0:o.numeroDocumento)??"",nombres:(o==null?void 0:o.nombres)??"",apellidoPaterno:(o==null?void 0:o.apellidoPaterno)??"",apellidoMaterno:(o==null?void 0:o.apellidoMaterno)??"",validar:(o==null?void 0:o.validar)??!1,equifax:(o==null?void 0:o.equifax)??"",obsEquifax:(o==null?void 0:o.obsEquifax)??"",listasControl:(o==null?void 0:o.listasControl)??"",obsListasControl:(o==null?void 0:o.obsListasControl)??"",continuar:Number((o==null?void 0:o.continuar)??1)}),po=async o=>{if(!o.ok){const s=await o.text();throw new Error(s||"Error en la solicitud")}return await o.json()},xo=()=>{var s;return{"Content-Type":"application/json",Authorization:`Bearer ${(s=JSON.parse(localStorage.getItem("user")))==null?void 0:s.token}`}},fo=async()=>{const o=await fetch(`${L}/ModoFirma`,{headers:xo()});return po(o)};function jo({id:o}){const[s,l]=t.useState([]),[c,m]=t.useState(null),[r,i]=t.useState({idModoFirma:"1",verDocumentosRequeridos:!1,confirmaCargaDocumentosCorrectos:!1}),[S,v]=t.useState([]),[A,p]=t.useState(!1),[w,d]=t.useState(!1),[N,g]=t.useState(!1),[M,k]=t.useState(null),[x,f]=t.useState(!0),j=async()=>{var e;f(!0);try{const[u,C,I]=await Promise.all([_(o,32),U(o),fo()]);l(u.data||[]),m(C.data[0]);const h=((e=C.data[0])==null?void 0:e.adjuntos)||{};i({idModoFirma:h.idModoFirma||"1",verDocumentosRequeridos:h.verDocumentosRequeridos||!1,confirmaCargaDocumentosCorrectos:h.confirmaCargaDocumentosCorrectos||!1}),v(I||[])}catch(u){n.error("Error al cargar adjuntos: "+u.message)}finally{f(!1)}};t.useEffect(()=>{j()},[o]);const F=e=>{k(e.idDocumento),g(!0)},E=async()=>{d(!1),p(!0);try{await V(o),await $({idMotivo:32,idSolicitudInversion:Number(o)}),i(e=>({...e,verDocumentosRequeridos:!0})),await j(),n.success("Documentos generados.")}catch{n.error("Error al generar documentos.")}finally{p(!1)}},T=async()=>{try{const e={...c,identificacion:ho(c.identificacion),adjuntos:r};(await J(o,e)).success?n.success("Sección documental guardada con exito."):n.error("Error al guardar.")}catch(e){n.error("Error: "+e.message)}},q=[{key:"idDocumento",label:"",render:e=>a.jsxs("div",{className:"flex items-center justify-center group relative text-gray-500",children:[a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",strokeWidth:"1.5",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6M5 4v16h14V4H5zm2 2h10v12H7V6z"})}),a.jsxs("span",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-1 text-xs text-white bg-zinc-800 px-2 py-0.5 rounded shadow opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-50 whitespace-nowrap",children:["ID: ",e]})]})},{key:"tipoDocumentoNombre",label:"Tipo de Documento"},{key:"motivoNombre",label:"Motivo"}];return a.jsxs("div",{className:"space-y-6 relative",children:[a.jsx(R,{visible:x||A,message:x?"Cargando datos...":"Generando documentos..."}),a.jsx("div",{className:"flex justify-end",children:a.jsxs(O,{onClick:T,className:"bg-primary text-white flex items-center gap-2 hover:bg-primary/80",children:[a.jsx(z,{className:"w-4 h-4"})," Guardar"]})}),a.jsx(b,{className:"p-6 border border-muted space-y-6",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[a.jsx(Co,{label:"Modo de Firma",options:S,value:r.idModoFirma,onChange:e=>i({...r,idModoFirma:e}),disabled:r.confirmaCargaDocumentosCorrectos}),a.jsx(D,{label:"¿Ver documentos requeridos?",checked:r.verDocumentosRequeridos,onChange:()=>d(!0),disabled:r.confirmaCargaDocumentosCorrectos}),a.jsx(D,{label:"¿Confirma que cargó todos los documentos?",checked:r.confirmaCargaDocumentosCorrectos,onChange:e=>i({...r,confirmaCargaDocumentosCorrectos:e})})]})}),a.jsxs(b,{className:"border border-muted shadow",children:[a.jsx(B,{children:a.jsx(G,{children:"Lista de Adjuntos"})}),a.jsx(H,{className:"p-6",children:a.jsx(W,{columns:q,data:s,mostrarEditar:!0,mostrarAgregarNuevo:!1,mostrarEliminar:!1,onEditarClick:F})})]}),a.jsx(K,{open:N,onOpenChange:g,children:a.jsxs(Q,{children:[a.jsxs(X,{children:[a.jsx(Y,{children:"Adjunto"}),a.jsx(Z,{children:"Editar archivo"})]}),a.jsx(P,{documentoId:M,onClose:()=>g(!1)})]})}),a.jsx(oo,{open:w,onOpenChange:d,children:a.jsxs(ao,{className:"bg-white text-gray-900 border border-gray-300",children:[a.jsx(eo,{children:a.jsx(ro,{children:"¿Deseas generar todos los documentos requeridos?"})}),a.jsxs(so,{children:[a.jsx(to,{children:"Cancelar"}),a.jsx(lo,{onClick:E,children:"Sí, generar"})]})]})})]})}function Co({label:o,options:s,value:l,onChange:c,disabled:m}){return a.jsxs("div",{className:"space-y-1.5",children:[a.jsx(y,{className:"text-sm font-medium text-gray-700",children:o}),a.jsxs(co,{value:l?String(l):"",onValueChange:c,disabled:m,children:[a.jsx(no,{className:"bg-white border border-gray-700",children:a.jsx(io,{placeholder:"Seleccionar..."})}),a.jsx(uo,{className:"bg-white",children:s.map(r=>a.jsx(mo,{value:String(r.idModoFirma),children:r.nombreModoFirma},r.idModoFirma))})]})]})}function D({label:o,checked:s,onChange:l,disabled:c}){return a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(go,{checked:s,onCheckedChange:l,disabled:c,className:`
          peer h-6 w-11 shrink-0 cursor-pointer items-center rounded-full
          border transition-colors duration-200 ease-in-out
          ${s?"bg-primary border-primary":"bg-white border-gray-400"}
        `}),a.jsx(y,{className:"text-sm text-gray-700 font-medium",children:o})]})}const Mo=Object.freeze(Object.defineProperty({__proto__:null,default:jo},Symbol.toStringTag,{value:"Module"}));export{jo as A,Mo as a,ho as m};
