import{A as O,e as I,u as M,r as o,j as e,G as P,B,l as L,t as g}from"./index-CG6H-kfp.js";import{a as H,u as _}from"./TareaService-CZcn_o-m.js";import{T as G}from"./TablaCustom2-CwS24NS9.js";import{A as $}from"./AdjuntoForm-idwOlVfp.js";import{D as J,a as U,b as V,c as W,d as Y}from"./dialog-2_FlWSQy.js";import{A as q,a as K,b as Q,c as X,d as Z,e as ee,f as ae}from"./alert-dialog-Bczf_PEy.js";const se=async r=>{if(!r.ok){const t=await r.text();throw new Error(t||"Error en la solicitud")}return await r.json()},re=()=>{var t;return{"Content-Type":"application/json",Authorization:`Bearer ${(t=JSON.parse(localStorage.getItem("user")))==null?void 0:t.token}`}},te=async r=>{const t=await fetch(`${O}/tarea/${r}`,{headers:re()}),s=await se(t);return Array.isArray(s)?s[0]||null:s};function me(){const{id:r}=I(),t=M(),[s,d]=o.useState(null),[m,y]=o.useState(!0),[v,N]=o.useState([]),[w,u]=o.useState(2),[b,j]=o.useState(""),[D,n]=o.useState(!1),[x,A]=o.useState(2),[C,T]=o.useState(null),[k,h]=o.useState(!1),R={1:23,2:23,3:14,4:7,5:8},f=async()=>{try{const a=await te(r);if(a.success){d(a.data),u(a.data.idResultado),j(a.data.observacion??"");const i=R[a.data.idTipoTarea],l=await H(1024,i);N(l)}}catch(a){g.error("Error al cargar la tarea: "+a.message)}finally{y(!1)}};o.useEffect(()=>{f()},[r]);const z=a=>{a===1||a===3?(A(a),n(!0)):u(a)},S=async()=>{var a,i;try{const l={idResultado:x,observacion:b,camposTipo:s.camposTipo};await _(s.idTarea,l),g.success("Tarea actualizada correctamente"),u(x)}catch(l){g.error("Error al actualizar tarea"+(((i=(a=l.response)==null?void 0:a.data)==null?void 0:i.message)||l.message))}finally{n(!1)}};if(m||!s)return e.jsx(P,{visible:!0,message:"Cargando tarea..."});const E=()=>{const a=s.camposTipo||{};switch(s.idTipoTarea){case 1:return e.jsxs(e.Fragment,{children:[e.jsx(c,{label:"Reemplazar contrato",checked:a.ReemplazarContrato,disabled:!0}),e.jsx(c,{label:"Reemplazar anexo",checked:a.ReemplazarAnexo,disabled:!0})]});case 2:return e.jsx(c,{label:"Reemplazar contrato adendum",checked:a.ReemplazarContratoAdendum,disabled:!0});case 3:return e.jsxs(e.Fragment,{children:[e.jsx(c,{label:"Firmado por gerencia",checked:a.FirmadoGerencia,disabled:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-800",children:"Modo de firma"}),e.jsxs("select",{value:a.IdTipoFirma,className:"w-full border border-gray-300 rounded-lg p-2 text-sm mt-1",disabled:!0,children:[e.jsx("option",{value:1,children:"Física"}),e.jsx("option",{value:2,children:"Digital"})]})]})]});case 4:return e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"text-sm font-medium text-gray-800",children:"Resumen"}),e.jsx("textarea",{value:a.DatosTarea,className:"w-full border border-gray-300 rounded-lg p-3 text-sm",rows:4,disabled:!0})]});case 5:return e.jsxs(e.Fragment,{children:[e.jsx(p,{label:"Fecha Operación",value:a.FechaOperacion,disabled:!0}),e.jsx(p,{label:"Cuenta Abono",value:a.CuentaAbono,disabled:!0}),e.jsx(p,{label:"N° Comprobante Abono",value:a.NumeroComprobanteAbono,disabled:!0})]});default:return null}},F=[{key:"idDocumento",label:"",render:a=>e.jsxs("div",{className:"flex items-center justify-center group relative text-gray-500",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",strokeWidth:"1.5",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6M5 4v16h14V4H5zm2 2h10v12H7V6z"})}),e.jsxs("span",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-1 text-xs text-white bg-zinc-800 px-2 py-0.5 rounded shadow opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-50",children:["ID: ",a]})]})},{key:"tipoDocumentoNombre",label:"Tipo de Documento"},{key:"motivoNombre",label:"Motivo"}];return e.jsxs("div",{className:"p-10 max-w-7xl mx-auto space-y-10 bg-white shadow rounded-xl",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs(B,{variant:"outline",onClick:()=>t("/tareas/vista"),children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"Volver al listado"]})}),e.jsxs("div",{className:"text-2xl font-bold",children:[s.nombreTipoTarea," - Nueva - ",e.jsx("span",{className:"font-normal text-gray-700",children:s.tareaNombre}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Tarea de solicitud"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-10",children:[e.jsxs("div",{className:"space-y-10",children:[e.jsxs("section",{className:"border border-gray-300 rounded-xl p-6 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Descripción"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded-lg p-3 text-sm text-gray-900 resize-y",rows:5,value:s.descripcion||"",disabled:!0})]}),e.jsxs("section",{className:"border border-gray-300 rounded-xl p-6 shadow-sm space-y-5",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Configuración de tarea"}),E()]})]}),e.jsx("div",{className:"space-y-10",children:e.jsxs("section",{className:"border border-gray-300 rounded-xl p-6 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Resultado"}),e.jsxs("select",{value:w,onChange:a=>z(Number(a.target.value)),className:"w-full border border-gray-300 rounded-lg p-3 text-sm",children:[e.jsx("option",{value:2,children:"Pendiente"}),e.jsx("option",{value:1,children:"Aprobado"}),e.jsx("option",{value:3,children:"Rechazado"})]}),e.jsx("label",{className:"block text-sm font-medium text-gray-800 mt-5 mb-1",children:"Observación"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded-lg p-3 text-sm text-gray-900 resize-y",rows:3,value:b,onChange:a=>j(a.target.value)})]})})]}),e.jsxs("section",{className:"border border-gray-300 rounded-xl p-6 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Documentos Adjuntos"}),e.jsx(G,{columns:F,data:v,mostrarEditar:!0,mostrarAgregarNuevo:!1,mostrarEliminar:!1,onEditarClick:a=>{T(a.idDocumento),h(!0)}})]}),e.jsx(J,{open:k,onOpenChange:h,children:e.jsxs(U,{children:[e.jsxs(V,{children:[e.jsx(W,{children:"Adjunto"}),e.jsx(Y,{children:"Editar archivo"})]}),e.jsx($,{documentoId:C,onClose:()=>{h(!1),f()}})]})}),e.jsx(q,{open:D,onOpenChange:n,children:e.jsxs(K,{className:"bg-white text-gray-900 border border-gray-300",children:[e.jsx(Q,{children:e.jsxs(X,{children:["¿Estás seguro de marcar esta tarea como ",x===1?"Aprobada":"Rechazada","?"]})}),e.jsxs(Z,{children:[e.jsx(ee,{onClick:()=>n(!1),children:"Cancelar"}),e.jsx(ae,{onClick:S,children:"Sí, confirmar"})]})]})})]})}function c({label:r,checked:t,onChange:s=()=>{},disabled:d}){return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium",children:r}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:m=>s(m.target.checked),className:"sr-only peer",disabled:d}),e.jsx("div",{className:"w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary/80 rounded-full peer peer-checked:bg-primary transition-all"}),e.jsx("div",{className:"absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition-transform peer-checked:translate-x-5"})]})]})}function p({label:r,value:t,disabled:s}){return e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-medium text-gray-800",children:r}),e.jsx("input",{type:"text",value:t||"",disabled:s,className:"w-full border border-gray-300 rounded-lg p-2 text-sm"})]})}export{me as default};
