import{f as S,r as n,j as e,G as D,I as h,B as A,g as k,h as O,t as w,L as T,u as M,C as L,c as $,d as G,a as q}from"./index-CG6H-kfp.js";import{D as z,a as V,b as F,c as _,d as B}from"./dialog-2_FlWSQy.js";import{c as U,g as P,d as H}from"./ProspectoService-CHx1iZIb.js";import{T as J}from"./TablaCustom2-CwS24NS9.js";import{S as j,a as b,b as f,c as C,d as y}from"./select-B3dX9JJ0.js";import{g as R}from"./ProductoInteresService-uZkqrmTw.js";import{g as W}from"./OrigenClienteService-Hn7RdPN2.js";import{g as K}from"./TipoIdentificacionService-DqUkVc03.js";import"./index-DMmKv1VD.js";function Q({onClose:i,onSaved:c}){const{user:o}=S(),[l,g]=n.useState({nombres:"",apellidoPaterno:"",apellidoMaterno:"",correoElectronico:"",telefonoCelular:"",idTipoIdentificacion:"",idOrigenCliente:"",idProductoInteres:"",idAgencia:""}),[m,x]=n.useState(!1),[p,N]=n.useState({tipoIdentificaciones:[],origenes:[],productos:[],agencias:[]});n.useEffect(()=>{(async()=>{try{const[d,u,I,E]=await Promise.all([O(),R(),W(),K()]);N({agencias:d,productos:u,origenes:I,tipoIdentificaciones:E})}catch{w.error("No se pudieron cargar los catálogos")}})()},[]);const s=(a,d)=>{g(u=>({...u,[a]:d}))},v=a=>{const u=a.replace(/\D/g,"").slice(0,10).replace(/(\d{3})(\d{3})(\d{0,4})/,"$1-$2-$3");s("telefonoCelular",u)},r=async a=>{a.preventDefault();const d={...l,estado:!0,idSolicitudInversion:null,fechaCreacion:new Date().toISOString(),fechaModificacion:new Date().toISOString(),idUsuarioCreacion:(o==null?void 0:o.id)||null,idUsuarioModificacion:(o==null?void 0:o.id)||null,idUsuarioPropietario:(o==null?void 0:o.id)||null,esCliente:!1};x(!0);try{await U(d),w.success("Prospecto guardado correctamente"),c==null||c(),i==null||i()}catch{w.error("Error al guardar prospecto")}finally{x(!1)}};return e.jsxs("div",{className:"p-4 relative",children:[e.jsx(D,{visible:m,message:"Guardando prospecto..."}),e.jsx("div",{className:"bg-white p-6 rounded-2xl border border-gray-200 shadow-md",children:e.jsxs("form",{onSubmit:r,className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(t,{label:"Nombres",children:e.jsx(h,{placeholder:"Ej: Juan Andrés",value:l.nombres,onChange:a=>s("nombres",a.target.value),required:!0})}),e.jsx(t,{label:"Apellido Paterno",children:e.jsx(h,{placeholder:"Ej: Pérez",value:l.apellidoPaterno,onChange:a=>s("apellidoPaterno",a.target.value),required:!0})}),e.jsx(t,{label:"Apellido Materno",children:e.jsx(h,{placeholder:"Ej: Gutiérrez",value:l.apellidoMaterno,onChange:a=>s("apellidoMaterno",a.target.value),required:!0})}),e.jsx(t,{label:"Correo Electrónico",children:e.jsx(h,{type:"email",placeholder:"Ej: ejemplo@correo.com",value:l.correoElectronico,onChange:a=>s("correoElectronico",a.target.value),required:!0})}),e.jsx(t,{label:"Teléfono Celular",children:e.jsx(h,{placeholder:"Ej: 099-123-4567",value:l.telefonoCelular,onChange:a=>v(a.target.value),maxLength:12,required:!0})}),e.jsx(t,{label:"Tipo de Identificación",children:e.jsxs(j,{onValueChange:a=>s("idTipoIdentificacion",Number(a)),children:[e.jsx(b,{children:e.jsx(f,{placeholder:"Seleccionar..."})}),e.jsx(C,{className:"bg-white",children:p.tipoIdentificaciones.map(a=>e.jsx(y,{value:a.idTipoIdentificacion.toString(),children:a.tipo},a.idTipoIdentificacion))})]})}),e.jsx(t,{label:"Origen del Cliente",children:e.jsxs(j,{onValueChange:a=>s("idOrigenCliente",Number(a)),children:[e.jsx(b,{children:e.jsx(f,{placeholder:"Seleccionar..."})}),e.jsx(C,{className:"bg-white",children:p.origenes.map(a=>e.jsx(y,{value:a.idOrigenCliente.toString(),children:a.nombreOrigen},a.idOrigenCliente))})]})}),e.jsx(t,{label:"Producto de Interés",children:e.jsxs(j,{onValueChange:a=>s("idProductoInteres",Number(a)),children:[e.jsx(b,{children:e.jsx(f,{placeholder:"Seleccionar..."})}),e.jsx(C,{className:"bg-white",children:p.productos.map(a=>e.jsx(y,{value:a.idProductoInteres.toString(),children:a.nombre},a.idProductoInteres))})]})}),e.jsx(t,{label:"Agencia",children:e.jsxs(j,{onValueChange:a=>s("idAgencia",Number(a)),children:[e.jsx(b,{children:e.jsx(f,{placeholder:"Seleccionar..."})}),e.jsx(C,{className:"bg-white",children:p.agencias.map(a=>e.jsx(y,{value:a.idAgencia.toString(),children:a.ciudad},a.idAgencia))})]})}),e.jsx("div",{className:"col-span-full",children:e.jsxs(A,{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg",children:[e.jsx(k,{className:"w-4 h-4 mr-2"})," Guardar Pago"]})})]})})]})}function t({label:i,children:c}){return e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(T,{className:"font-medium text-gray-700 text-sm",children:i}),c]})}function le(){const i=M(),[c,o]=n.useState([]),[l,g]=n.useState(!1),m=async()=>{try{const r=await P();o(r)}catch(r){console.error("Error al cargar prospectos:",r)}};n.useEffect(()=>{m()},[]),n.useEffect(()=>{(async()=>{try{const a=await P();o(a)}catch(a){console.error("Error al cargar prospectos:",a)}})()},[]);const x=r=>{i(`/pagos/editar/${r.idProspecto}`)},p=async r=>{try{await H(r.idProspecto)}catch(a){console.error("Error al eliminar prospecto:",a)}},N=()=>{g(!0)},s=()=>{g(!1)},v=[{key:"idProspecto",label:"Prospecto",render:r=>e.jsxs("div",{className:"flex items-center justify-center group relative text-gray-500",children:[e.jsx("svg",{className:"w-5 h-5 md:w-6 md:h-6",fill:"none",stroke:"currentColor",strokeWidth:"1.8",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.121 17.804A9.003 9.003 0 0112 15c2.486 0 4.735.996 6.364 2.634M15 11a3 3 0 11-6 0 3 3 0 016 0z"})}),e.jsxs("span",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-1 text-xs text-white bg-zinc-800 px-2 py-0.5 rounded shadow opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-50 whitespace-nowrap",children:["ID: ",r]})]})},{key:"nombreCompleto",label:"Nombre completo",render:(r,a)=>e.jsx("span",{className:"whitespace-nowrap",children:`${a.nombres??""} ${a.apellidoPaterno??""} ${a.apellidoMaterno??""}`})},{key:"tipoIdentificacion",label:"Tipo ID"},{key:"telefonoCelular",label:"Núm. Celular"},{key:"correoElectronico",label:"Correo"},{key:"nombreOrigen",label:"Origen"},{key:"productoInteres",label:"Producto de Interés"},{key:"agencia",label:"Agencia"},{key:"estado",label:"Estado",render:r=>e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${r?"bg-green-100 text-green-700":"bg-yellow-200 text-yellow-700"}`,children:r?"Activo":"Inactivo"})}];return e.jsxs("div",{className:"p-4 sm:p-6 md:p-8 max-w-full",children:[e.jsxs(L,{className:"w-full border border-muted rounded-xl shadow-[0_4px_10px_rgba(0,0,0,0.12)]",children:[e.jsx($,{children:e.jsx(G,{className:"text-3xl",children:"Lista de Pagos"})}),e.jsx(q,{className:"p-6 overflow-x-auto",children:e.jsx(J,{columns:v,data:c,mostrarEditar:!0,mostrarAgregarNuevo:!0,mostrarEliminar:!0,onAgregarNuevoClick:N,onEditarClick:x,onEliminarClick:p})})]}),e.jsx(z,{open:l,onOpenChange:g,className:"min-w-3xl",children:e.jsxs(V,{className:"min-w-3xl",children:[e.jsxs(F,{children:[e.jsx(_,{children:"Agregar Pago"}),e.jsx(B,{children:"Completa la información del nuevo prospecto"})]}),e.jsx(Q,{onClose:s,onSaved:m})]})})]})}export{le as default};
